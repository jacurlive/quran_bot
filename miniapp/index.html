<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:          #0F1117;
      --surface:     #1A1D27;
      --surface-2:   #252836;
      --primary:     #4E9E6A;
      --primary-10:  rgba(78,158,106,0.12);
      --primary-20:  rgba(78,158,106,0.22);
      --gold:        #C9A96E;
      --text:        #E8E8E8;
      --text-2:      #A0A8B8;
      --text-3:      #565E72;
      --border:      #2A2F3E;
      --shadow:      rgba(0,0,0,0.35);
      --radius:      18px;
      --radius-sm:   12px;
      --nav-h:       64px;
    }
    [data-theme="light"] {
      --bg:          #F5F1EC;
      --surface:     #FFFFFF;
      --surface-2:   #EDEBE7;
      --primary:     #3A6B4A;
      --primary-10:  rgba(58,107,74,0.10);
      --primary-20:  rgba(58,107,74,0.20);
      --gold:        #B08D57;
      --text:        #1A1A1A;
      --text-2:      #555555;
      --text-3:      #999999;
      --border:      #E5E1DB;
      --shadow:      rgba(0,0,0,0.06);
    }

    html, body {
      height: 100%;
      overflow: hidden;
      background: var(--bg);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      -webkit-tap-highlight-color: transparent;
    }

    #app {
      height: 100%;
      position: relative;
      display: flex;
      flex-direction: column;
    }

    /* â”€â”€ SCREENS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .screen {
      position: absolute;
      inset: 0;
      bottom: calc(var(--nav-h) + env(safe-area-inset-bottom, 0px));
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      opacity: 0;
      pointer-events: none;
      transform: translateY(6px);
      transition: opacity 0.2s ease, transform 0.2s ease;
    }
    .screen.active {
      opacity: 1;
      pointer-events: all;
      transform: translateY(0);
    }

    /* â”€â”€ BOTTOM NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #bottom-nav {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: calc(var(--nav-h) + env(safe-area-inset-bottom, 0px));
      padding-bottom: env(safe-area-inset-bottom, 0px);
      background: var(--surface);
      border-top: 1px solid var(--border);
      display: flex;
      z-index: 100;
    }
    .nav-btn {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      background: none;
      border: none;
      cursor: pointer;
      color: var(--text-3);
      transition: color 0.15s;
      padding: 6px 0 0;
      position: relative;
    }
    .nav-btn.active { color: var(--primary); }
    .nav-btn svg { width: 22px; height: 22px; stroke-width: 1.7; }
    .nav-btn span { font-size: 10px; font-weight: 500; letter-spacing: 0.2px; }
    .nav-btn.active::after {
      content: '';
      position: absolute;
      top: 0; left: 50%;
      transform: translateX(-50%);
      width: 28px; height: 2px;
      background: var(--primary);
      border-radius: 0 0 2px 2px;
    }

    /* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
       SCREEN 1 Â· SURAH LIST
    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
    .list-header {
      padding: 20px 20px 14px;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .list-kicker {
      font-size: 11px;
      font-weight: 500;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: var(--text-3);
      margin-bottom: 2px;
    }
    .list-arabic-title {
      font-family: 'Scheherazade New', serif;
      font-size: 26px;
      color: var(--text);
      direction: rtl;
      line-height: 1.2;
      margin-bottom: 14px;
    }
    .search-wrap { position: relative; }
    .search-icon {
      position: absolute;
      left: 12px; top: 50%;
      transform: translateY(-50%);
      color: var(--text-3);
      pointer-events: none;
    }
    #search-input {
      width: 100%;
      padding: 10px 12px 10px 38px;
      background: var(--surface-2);
      border: 1.5px solid transparent;
      border-radius: var(--radius-sm);
      font-size: 14px;
      color: var(--text);
      outline: none;
      font-family: inherit;
      transition: border-color 0.15s;
    }
    #search-input:focus { border-color: var(--primary-20); }
    #search-input::placeholder { color: var(--text-3); }

    .surah-list-wrap { padding: 10px 14px 16px; }

    .surah-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 13px 14px;
      background: var(--surface);
      border-radius: var(--radius-sm);
      margin-bottom: 7px;
      cursor: pointer;
      transition: transform 0.12s, opacity 0.12s;
      box-shadow: 0 1px 4px var(--shadow);
      border: 1.5px solid transparent;
    }
    .surah-item:active { transform: scale(0.975); opacity: 0.85; }
    .surah-item.playing { border-color: var(--primary-20); }

    .surah-num-badge {
      width: 38px; height: 38px;
      border-radius: 50%;
      background: var(--primary-10);
      display: flex; align-items: center; justify-content: center;
      font-size: 12px; font-weight: 600;
      color: var(--primary);
      flex-shrink: 0;
    }
    .surah-item.playing .surah-num-badge {
      background: var(--primary);
      color: #fff;
    }

    .surah-info { flex: 1; min-width: 0; }
    .surah-name-ru {
      font-size: 14px; font-weight: 500;
      color: var(--text); margin-bottom: 2px;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .surah-name-en { font-size: 11px; color: var(--text-3); }

    .surah-right { text-align: right; flex-shrink: 0; }
    .surah-name-ar {
      font-family: 'Scheherazade New', serif;
      font-size: 20px; color: var(--gold);
      direction: rtl; display: block;
      line-height: 1.3; margin-bottom: 1px;
    }
    .surah-ayah-count { font-size: 10px; color: var(--text-3); }

    .empty-state {
      text-align: center; padding: 48px 20px;
      color: var(--text-3); font-size: 14px;
    }

    /* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
       SCREEN 2 Â· PLAYER
    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
    #screen-player { display: flex; flex-direction: column; }

    .player-topbar {
      display: flex; align-items: center;
      padding: 14px 16px; gap: 10px;
    }
    .icon-btn {
      width: 36px; height: 36px;
      border-radius: 50%;
      background: var(--surface);
      border: none; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      color: var(--text);
      box-shadow: 0 1px 4px var(--shadow);
      flex-shrink: 0;
      transition: transform 0.12s;
    }
    .icon-btn:active { transform: scale(0.9); }

    /* Now-playing info block */
    .player-info {
      display: flex; align-items: center;
      padding: 4px 20px 14px; gap: 12px;
    }
    .player-info-text { flex: 1; min-width: 0; }
    .player-info-title {
      font-size: 20px; font-weight: 700; color: var(--text);
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
      margin-bottom: 4px;
    }
    .player-info-bottom {
      display: flex; align-items: center; gap: 10px;
    }
    .player-info-reciter {
      font-size: 13px; font-weight: 500; color: var(--gold);
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
      flex: 1;
    }
    .player-info-dots { flex-shrink: 0; }

    /* Disc */
    .disc-wrap {
      flex: 1;
      display: flex; justify-content: center; align-items: center;
      padding: 8px 20px;
    }
    .disc-container {
      position: relative;
      width: 232px; height: 232px;
      flex-shrink: 0;
    }
    .disc-ring {
      position: absolute; inset: 0;
      border-radius: 50%;
      border: 2px solid var(--primary);
      opacity: 0;
      pointer-events: none;
    }
    .disc-container.playing .disc-ring {
      animation: ring-wave 2.6s ease-out infinite;
    }
    .disc-container.playing .r1 { animation-delay: 0s; }
    .disc-container.playing .r2 { animation-delay: 0.87s; }
    .disc-container.playing .r3 { animation-delay: 1.73s; }

    .disc-container.fading .disc-ring {
      animation: ring-fadeout 1.4s ease-out forwards;
    }
    .disc-container.fading .r1 { animation-delay: 0s; }
    .disc-container.fading .r2 { animation-delay: 0.12s; }
    .disc-container.fading .r3 { animation-delay: 0.24s; }

    @keyframes ring-wave {
      0%   { transform: scale(1);    opacity: 0; }
      8%   { opacity: 0.55; }
      100% { transform: scale(1.75); opacity: 0; }
    }
    @keyframes ring-fadeout {
      0%   { transform: scale(1.1); opacity: 0.4; }
      100% { transform: scale(1.55); opacity: 0; }
    }

    .disc {
      position: absolute; inset: 0;
      border-radius: 50%;
      background: var(--surface);
      box-shadow: 0 8px 40px rgba(0,0,0,0.22), 0 2px 8px rgba(0,0,0,0.12);
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
    }
    .disc-container.playing .disc {
      box-shadow: 0 10px 50px rgba(78,158,106,0.28), 0 2px 8px rgba(0,0,0,0.12);
      transition: box-shadow 0.6s ease;
    }
    .disc::before {
      content: '';
      position: absolute; inset: 12px;
      border-radius: 50%;
      border: 1px solid var(--border);
    }
    .disc::after {
      content: '';
      position: absolute; inset: 22px;
      border-radius: 50%;
      border: 1px dashed var(--border);
    }
    .disc-arabic {
      font-family: 'Scheherazade New', serif;
      font-size: 46px; color: var(--primary);
      direction: rtl; line-height: 1;
      position: relative; z-index: 1;
    }
    .disc-label {
      font-size: 12px; color: var(--text-3); font-weight: 500;
      margin-top: 8px; position: relative; z-index: 1;
    }

    .ayah-counter {
      display: inline-flex; align-items: center; gap: 6px;
    }
    .ayah-dot {
      width: 6px; height: 6px; border-radius: 50%;
      background: var(--border);
      transition: background 0.2s;
      flex-shrink: 0;
    }
    .ayah-dot.active { background: var(--primary); }

    /* Ayah text card */
    .ayah-card {
      margin: 0 14px 0;
      background: var(--surface);
      border-radius: var(--radius);
      padding: 14px 18px 12px;
      box-shadow: 0 1px 4px var(--shadow);
      max-height: 120px; overflow-y: auto;
    }
    .ayah-arabic-text {
      font-family: 'Scheherazade New', serif;
      font-size: 19px; line-height: 1.8;
      color: var(--text);
      direction: rtl; text-align: right;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border);
    }
    .ayah-translation-text {
      font-size: 12px; line-height: 1.6;
      color: var(--text-2);
    }

    /* Progress */
    .progress-area { padding: 16px 20px 12px; }
    .progress-track {
      height: 3px; background: var(--border); border-radius: 3px;
      position: relative; cursor: pointer; margin-bottom: 7px;
    }
    .progress-fill {
      height: 100%; background: var(--primary); border-radius: 3px;
      width: 0%; transition: width 0.4s linear;
      position: relative;
    }
    .progress-fill::after {
      content: '';
      position: absolute; right: -5px; top: -4px;
      width: 11px; height: 11px; border-radius: 50%;
      background: var(--primary);
      box-shadow: 0 0 0 3px var(--primary-10);
    }
    .progress-times {
      display: flex; justify-content: space-between;
      font-size: 11px; color: var(--text-3);
      font-variant-numeric: tabular-nums;
    }

    /* Controls */
    .controls-row {
      display: flex; align-items: center; justify-content: center;
      gap: 10px; padding: 4px 20px 16px;
    }
    .ctrl {
      width: 50px; height: 50px;
      border-radius: 50%;
      background: var(--surface);
      border: none; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      color: var(--text-2);
      box-shadow: 0 2px 8px var(--shadow);
      transition: transform 0.1s, opacity 0.15s;
    }
    .ctrl:active { transform: scale(0.88); }
    .ctrl:disabled { opacity: 0.3; pointer-events: none; }
    .ctrl svg { width: 20px; height: 20px; }
    .ctrl.play {
      width: 70px; height: 70px;
      background: var(--primary); color: #fff;
      box-shadow: 0 6px 20px rgba(78,158,106,0.40);
    }
    .ctrl.play svg { width: 30px; height: 30px; }

    /* Surah nav row */
    .surah-nav-row {
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 14px 20px;
      gap: 10px;
    }
    .surah-nav-btn {
      flex: 1; display: flex; align-items: center; justify-content: center;
      gap: 6px; padding: 10px 12px;
      background: var(--surface); border: none; border-radius: var(--radius-sm);
      color: var(--text-2); font-size: 12px; font-weight: 500;
      cursor: pointer; font-family: inherit;
      box-shadow: 0 1px 4px var(--shadow);
      transition: transform 0.1s, opacity 0.15s;
    }
    .surah-nav-btn:active { transform: scale(0.95); }
    .surah-nav-btn:disabled { opacity: 0.3; pointer-events: none; }
    .surah-nav-btn svg { width: 14px; height: 14px; flex-shrink: 0; }

    /* Empty player */
    .player-empty {
      flex: 1;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      gap: 12px; padding: 40px 30px;
      text-align: center;
    }
    .player-empty-ornament {
      font-family: 'Scheherazade New', serif;
      font-size: 60px; color: var(--border);
      line-height: 1;
    }
    .player-empty-title { font-size: 17px; font-weight: 500; color: var(--text); }
    .player-empty-sub { font-size: 13px; color: var(--text-3); line-height: 1.5; }
    .btn-browse {
      margin-top: 8px;
      padding: 12px 28px;
      background: var(--primary); color: #fff;
      border: none; border-radius: 50px;
      font-size: 14px; font-weight: 500;
      font-family: inherit; cursor: pointer;
      box-shadow: 0 4px 14px rgba(58,107,74,0.3);
      transition: transform 0.1s;
    }
    .btn-browse:active { transform: scale(0.96); }

    /* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
       SCREEN 3 Â· RECITERS
    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
    .reciters-header {
      padding: 24px 20px 18px;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
    }
    .reciters-title { font-size: 22px; font-weight: 600; color: var(--text); margin-bottom: 3px; }
    .reciters-sub { font-size: 13px; color: var(--text-3); }

    .reciters-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      padding: 14px;
    }
    .reciter-card {
      background: var(--surface);
      border-radius: var(--radius);
      padding: 20px 14px 16px;
      text-align: center; cursor: pointer;
      border: 2px solid transparent;
      box-shadow: 0 1px 4px var(--shadow);
      transition: transform 0.12s, border-color 0.15s;
      position: relative;
    }
    .reciter-card.selected { border-color: var(--primary); }
    .reciter-card:active { transform: scale(0.95); }

    .reciter-avatar {
      width: 52px; height: 52px; border-radius: 50%;
      background: var(--primary-10);
      display: flex; align-items: center; justify-content: center;
      margin: 0 auto 11px;
      font-size: 17px; font-weight: 600;
      color: var(--primary);
      transition: background 0.15s, color 0.15s;
    }
    .reciter-card.selected .reciter-avatar { background: var(--primary); color: #fff; }

    .reciter-name-text {
      font-size: 12px; font-weight: 500;
      color: var(--text); line-height: 1.4;
    }

    .reciter-checkmark {
      position: absolute; top: 9px; right: 9px;
      width: 18px; height: 18px; border-radius: 50%;
      background: var(--primary);
      display: none; align-items: center; justify-content: center;
    }
    .reciter-card.selected .reciter-checkmark { display: flex; }

    /* Waveform animation (decorative) */
    .waveform {
      display: flex; align-items: center;
      justify-content: center; gap: 3px;
      height: 20px; margin-bottom: 4px;
    }
    .waveform.hidden { display: none; }
    .wave-bar {
      width: 3px; border-radius: 3px;
      background: var(--primary);
      animation: wave 1.2s ease-in-out infinite;
    }
    .wave-bar:nth-child(1) { height: 6px;  animation-delay: 0s; }
    .wave-bar:nth-child(2) { height: 12px; animation-delay: 0.1s; }
    .wave-bar:nth-child(3) { height: 16px; animation-delay: 0.2s; }
    .wave-bar:nth-child(4) { height: 10px; animation-delay: 0.3s; }
    .wave-bar:nth-child(5) { height: 14px; animation-delay: 0.15s; }
    @keyframes wave {
      0%, 100% { transform: scaleY(1); opacity: 0.7; }
      50%       { transform: scaleY(0.4); opacity: 1; }
    }

    /* Mode tabs */
    .mode-tabs {
      display: flex; gap: 0; margin-bottom: 12px;
      background: var(--surface-2); border-radius: var(--radius-sm); padding: 3px;
    }
    .mode-tab {
      flex: 1; padding: 8px 4px; border: none; cursor: pointer;
      background: none; border-radius: calc(var(--radius-sm) - 3px);
      font-family: inherit; font-size: 13px; font-weight: 500;
      color: var(--text-3); transition: all 0.15s;
    }
    .mode-tab.active { background: var(--surface); color: var(--text); box-shadow: 0 1px 3px var(--shadow); }
    .mode-tab:active { transform: scale(0.97); }

    /* Ayah list back header */
    .ayah-list-header {
      padding: 14px 16px 12px;
      background: var(--surface); border-bottom: 1px solid var(--border);
      position: sticky; top: 0; z-index: 10;
      display: flex; align-items: center; gap: 10px;
    }
    .ayah-list-surah-info { flex: 1; }
    .ayah-list-surah-name { font-size: 16px; font-weight: 600; color: var(--text); }
    .ayah-list-surah-ar {
      font-family: 'Scheherazade New', serif; font-size: 18px;
      color: var(--gold); direction: rtl;
    }
    .ayah-item {
      display: flex; align-items: center; gap: 12px;
      padding: 13px 14px; background: var(--surface);
      border-radius: var(--radius-sm); margin-bottom: 7px;
      cursor: pointer; transition: transform 0.12s, opacity 0.12s;
      box-shadow: 0 1px 4px var(--shadow); border: 1.5px solid transparent;
    }
    .ayah-item:active { transform: scale(0.975); opacity: 0.85; }
    .ayah-item.playing { border-color: var(--primary-20); }
    .ayah-item.playing .surah-num-badge { background: var(--primary); color: #fff; }
    .ayah-item-info { flex: 1; }
    .ayah-item-num { font-size: 14px; font-weight: 500; color: var(--text); }
    .ayah-item-hint { font-size: 11px; color: var(--text-3); margin-top: 1px; }

    /* Hide ayah card in surah mode */
    /* Surah mode: disc fills top, no ayah card */
    .mode-surah .ayah-card { display: none; }
    .mode-surah .player-info-dots { display: none; }
    .mode-surah #btn-prev-ayah { display: none; }
    .mode-surah #btn-next-ayah { display: none; }

    /* Ayah mode: disc fixed, card expands fully */
    #player-ui:not(.mode-surah) .disc-wrap {
      flex: 0 0 auto;
    }
    #player-ui:not(.mode-surah) .ayah-card {
      max-height: none;
      overflow-y: visible;
      flex: 1;
    }

    /* â”€â”€ SCREEN 4 Â· PROFILE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .profile-header {
      padding: 32px 20px 24px;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      display: flex; flex-direction: column; align-items: center; gap: 12px;
    }
    .profile-avatar {
      width: 80px; height: 80px; border-radius: 50%;
      background: var(--primary-10); border: 3px solid var(--primary-20);
      display: flex; align-items: center; justify-content: center;
      font-size: 28px; font-weight: 700; color: var(--primary);
      overflow: hidden; flex-shrink: 0;
    }
    .profile-avatar img { width: 100%; height: 100%; object-fit: cover; }
    .profile-name { font-size: 20px; font-weight: 700; color: var(--text); text-align: center; }
    .profile-username { font-size: 13px; color: var(--text-3); margin-top: -6px; }

    .profile-section { padding: 14px 14px 0; }
    .profile-section-title {
      font-size: 11px; font-weight: 600; letter-spacing: 0.8px;
      text-transform: uppercase; color: var(--text-3);
      padding: 0 6px; margin-bottom: 8px;
    }
    .profile-card {
      background: var(--surface); border-radius: var(--radius);
      box-shadow: 0 1px 4px var(--shadow); overflow: hidden;
    }
    .profile-row {
      display: flex; align-items: center; gap: 14px;
      padding: 14px 16px; border-bottom: 1px solid var(--border);
    }
    .profile-row:last-child { border-bottom: none; }
    .profile-row-icon {
      width: 34px; height: 34px; border-radius: 10px;
      background: var(--primary-10);
      display: flex; align-items: center; justify-content: center;
      color: var(--primary); flex-shrink: 0;
    }
    .profile-row-icon svg { width: 16px; height: 16px; }
    .profile-row-body { flex: 1; min-width: 0; }
    .profile-row-label { font-size: 11px; color: var(--text-3); margin-bottom: 1px; }
    .profile-row-value { font-size: 14px; font-weight: 500; color: var(--text);
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

    /* â”€â”€ SLEEP TIMER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .sleep-row {
      display: flex; align-items: center; justify-content: center;
      padding: 0 20px 16px; gap: 8px;
    }
    .sleep-btn {
      display: flex; align-items: center; gap: 6px;
      padding: 7px 14px; border-radius: 20px;
      border: 1.5px solid var(--border);
      background: var(--surface-2); color: var(--text-3);
      font-family: inherit; font-size: 12px; font-weight: 500;
      cursor: pointer; transition: all 0.15s;
    }
    .sleep-btn svg { width: 14px; height: 14px; flex-shrink: 0; }
    .sleep-btn.active {
      border-color: var(--primary); background: var(--primary-10); color: var(--primary);
    }
    .sleep-btn:active { transform: scale(0.95); }

    /* Sleep modal */
    .sleep-modal {
      position: fixed; inset: 0; z-index: 300;
      background: rgba(0,0,0,0.55);
      display: flex; align-items: flex-end;
      opacity: 0; pointer-events: none;
      transition: opacity 0.22s;
    }
    .sleep-modal.open { opacity: 1; pointer-events: all; }
    .sleep-sheet {
      width: 100%; background: var(--surface);
      border-radius: 24px 24px 0 0;
      padding: 8px 24px calc(28px + env(safe-area-inset-bottom,0px));
      transform: translateY(100%);
      transition: transform 0.32s cubic-bezier(0.34,1.05,0.64,1);
    }
    .sleep-modal.open .sleep-sheet { transform: translateY(0); }
    .sleep-drag-handle {
      width: 36px; height: 4px; border-radius: 2px;
      background: var(--border); margin: 10px auto 20px;
    }
    .sleep-sheet-title {
      text-align: center; font-size: 17px; font-weight: 600;
      color: var(--text); margin-bottom: 24px;
    }
    .sleep-dial-wrap {
      display: flex; justify-content: center;
      margin-bottom: 20px;
      touch-action: none; user-select: none; -webkit-user-select: none;
    }
    .sleep-dial-wrap svg { touch-action: none; overflow: visible; }
    .sleep-eos-row {
      display: flex; justify-content: center; margin-bottom: 22px;
    }
    .sleep-eos-btn {
      padding: 8px 20px; border-radius: 20px;
      border: 1.5px solid var(--border);
      background: var(--surface-2); color: var(--text-2);
      font-family: inherit; font-size: 13px; font-weight: 500;
      cursor: pointer; transition: all 0.15s;
    }
    .sleep-eos-btn.active {
      border-color: var(--primary); background: var(--primary-10); color: var(--primary);
    }
    .sleep-eos-btn:active { transform: scale(0.95); }
    .sleep-actions { display: flex; gap: 10px; }
    .sleep-action-btn {
      flex: 1; padding: 15px; border-radius: 16px; border: none;
      font-family: inherit; font-size: 15px; font-weight: 600;
      cursor: pointer; transition: transform 0.12s;
    }
    .sleep-action-btn:active { transform: scale(0.97); }
    .sleep-cancel  { background: var(--surface-2); color: var(--text-2); }
    .sleep-confirm { background: var(--primary);   color: #fff; }

    /* â”€â”€ FAVORITES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .heart-btn {
      width: 32px; height: 32px; border-radius: 50%;
      background: none; border: none; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      color: var(--text-3); flex-shrink: 0;
      transition: color 0.15s, transform 0.15s;
      padding: 0;
    }
    .heart-btn:active { transform: scale(0.85); }
    .heart-btn.fav { color: #E05C5C; }
    .heart-btn svg { width: 18px; height: 18px; }
    .heart-btn.fav svg { fill: #E05C5C; stroke: #E05C5C; }

    /* heart in player topbar */
    .icon-btn.fav { color: #E05C5C; }
    .icon-btn.fav svg { fill: #E05C5C; stroke: #E05C5C; }

    /* favorites screen */
    .favs-header {
      padding: 20px 20px 16px; background: var(--surface);
      border-bottom: 1px solid var(--border);
      position: sticky; top: 0; z-index: 10;
    }
    .favs-title { font-size: 22px; font-weight: 700; color: var(--text); margin-bottom: 2px; }
    .favs-sub   { font-size: 13px; color: var(--text-3); }
    .favs-wrap  { padding: 10px 14px 16px; }

    .fav-item {
      display: flex; align-items: center; gap: 12px;
      padding: 13px 14px; background: var(--surface);
      border-radius: var(--radius-sm); margin-bottom: 7px;
      cursor: pointer; border: 1.5px solid transparent;
      box-shadow: 0 1px 4px var(--shadow);
      transition: transform 0.12s, opacity 0.12s;
    }
    .fav-item:active { transform: scale(0.975); opacity: 0.85; }
    .fav-badge {
      width: 38px; height: 38px; border-radius: 50%;
      background: rgba(224,92,92,0.12);
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
    }
    .fav-badge svg { width: 16px; height: 16px; fill: #E05C5C; stroke: #E05C5C; }
    .fav-info { flex: 1; min-width: 0; }
    .fav-name { font-size: 14px; font-weight: 500; color: var(--text);
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .fav-meta { font-size: 11px; color: var(--text-3); margin-top: 1px; }
    .fav-ar {
      font-family: 'Scheherazade New', serif;
      font-size: 20px; color: var(--gold); direction: rtl; flex-shrink: 0;
    }
    .fav-remove {
      width: 28px; height: 28px; border-radius: 50%;
      border: none; background: none; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      color: var(--text-3); transition: color 0.15s;
    }
    .fav-remove:active { color: #E05C5C; }
    .fav-remove svg { width: 14px; height: 14px; }

    /* Theme/Lang toggles */
    .header-controls {
      display: flex; gap: 6px; margin-bottom: 10px; justify-content: flex-end;
    }
    .toggle-btn {
      padding: 4px 10px; border-radius: 20px; border: 1.5px solid var(--border);
      background: var(--surface-2); color: var(--text-2);
      font-size: 11px; font-weight: 600; font-family: inherit;
      cursor: pointer; transition: all 0.15s; letter-spacing: 0.3px;
    }
    .toggle-btn.active { background: var(--primary); color: #fff; border-color: var(--primary); }
    .toggle-btn:active { transform: scale(0.93); }

    /* Loading overlay on ayah card */
    .ayah-card { position: relative; min-height: 80px; }
    .ayah-loading {
      position: absolute; inset: 0; display: flex; align-items: center;
      justify-content: center; border-radius: var(--radius);
      background: var(--surface); z-index: 2;
    }
    .ayah-loading .spinner {
      width: 22px; height: 22px; border-radius: 50%;
      border: 2.5px solid var(--border); border-top-color: var(--primary);
      animation: spin 0.7s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .ayah-loading.hidden { display: none; }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 0; height: 0; }
  </style>
</head>
<body>
<div id="app">

  <!-- â•â• SCREEN: LIST â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen active" id="screen-list">
    <div class="list-header">
      <div class="header-controls">
        <button class="toggle-btn" id="btn-lang-ru" onclick="setLang('ru')">RU</button>
        <button class="toggle-btn" id="btn-lang-uz" onclick="setLang('uz')">UZ</button>
        <button class="toggle-btn" id="btn-theme" onclick="toggleTheme()">â˜€ï¸</button>
      </div>
      <div class="list-kicker" id="list-kicker">Ğ¡Ğ²ÑÑ‰ĞµĞ½Ğ½Ñ‹Ğ¹ ĞšĞ¾Ñ€Ğ°Ğ½</div>
      <div class="list-arabic-title">Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</div>
      <div class="mode-tabs">
        <button class="mode-tab active" id="tab-surah" onclick="setMode('surah')"></button>
        <button class="mode-tab" id="tab-ayah" onclick="setMode('ayah')"></button>
      </div>
      <div class="search-wrap">
        <svg class="search-icon" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2">
          <circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/>
        </svg>
        <input type="search" id="search-input" placeholder="ĞŸĞ¾Ğ¸ÑĞº ÑÑƒÑ€Ñ‹â€¦" autocomplete="off" spellcheck="false">
      </div>
    </div>
    <div class="surah-list-wrap" id="surah-list"></div>
  </div>

  <!-- â•â• SCREEN: FAVORITES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen" id="screen-favorites">
    <div class="favs-header">
      <div class="favs-title" id="favs-title">Ğ˜Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ</div>
      <div class="favs-sub" id="favs-sub">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½Ğ½Ñ‹Ğµ ÑÑƒÑ€Ñ‹ Ğ¸ Ğ°ÑÑ‚Ñ‹</div>
    </div>
    <div class="favs-wrap" id="favs-list"></div>
  </div>

  <!-- â•â• SCREEN: AYAH LIST â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen" id="screen-ayah-list">
    <div class="ayah-list-header">
      <button class="icon-btn" onclick="showScreen('list')">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <path d="M19 12H5M12 5l-7 7 7 7"/>
        </svg>
      </button>
      <div class="ayah-list-surah-info">
        <div class="ayah-list-surah-name" id="ayah-list-title">â€”</div>
        <div class="ayah-list-surah-ar" id="ayah-list-ar">â€”</div>
      </div>
    </div>
    <div class="surah-list-wrap" id="ayah-list"></div>
  </div>

  <!-- â•â• SCREEN: PLAYER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen" id="screen-player">

    <!-- Empty state (no surah selected) -->
    <div class="player-empty" id="player-empty">
      <div class="player-empty-ornament">ï·½</div>
      <div class="player-empty-title" id="player-empty-title">Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑÑƒÑ€Ñƒ</div>
      <div class="player-empty-sub" id="player-empty-sub">ĞŸĞµÑ€ĞµĞ¹Ğ´Ğ¸Ñ‚Ğµ Ğº ÑĞ¿Ğ¸ÑĞºÑƒ ÑÑƒÑ€<br>Ğ¸ Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ»ÑĞ±ÑƒÑ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ»ÑƒÑˆĞ¸Ğ²Ğ°Ğ½Ğ¸Ñ</div>
      <button class="btn-browse" id="btn-browse" onclick="showScreen('list')">ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº</button>
    </div>

    <!-- Player UI (hidden until surah selected) -->
    <div id="player-ui" style="display:none; flex-direction:column; flex:1;">

      <div class="player-topbar">
        <button class="icon-btn" onclick="showScreen('list')">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <path d="M19 12H5M12 5l-7 7 7 7"/>
          </svg>
        </button>
        <div style="flex:1"></div>
        <button class="icon-btn" onclick="showScreen('reciters')">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2a3 3 0 0 1 3 3v7a3 3 0 0 1-6 0V5a3 3 0 0 1 3-3z"/>
            <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
          </svg>
        </button>
      </div>

      <div class="disc-wrap">
        <div class="disc-container" id="disc-container">
          <div class="disc-ring r1"></div>
          <div class="disc-ring r2"></div>
          <div class="disc-ring r3"></div>
          <div class="disc" id="player-disc">
            <div class="disc-arabic" id="disc-arabic">Ø§Ù„ÙØ§ØªØ­Ø©</div>
            <div class="disc-label" id="disc-label">Ğ¡ÑƒÑ€Ğ° 1</div>
          </div>
        </div>
      </div>

      <!-- Spotify-style info block -->
      <div class="player-info">
        <div class="player-info-text">
          <div class="player-info-title" id="player-title">â€”</div>
          <div class="player-info-bottom">
            <div class="player-info-reciter" id="player-reciter">â€”</div>
            <div class="player-info-dots">
              <div class="ayah-counter" id="ayah-dots"></div>
            </div>
          </div>
        </div>
        <button class="icon-btn" id="player-fav-btn" onclick="toggleFav()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
          </svg>
        </button>
      </div>

      <div class="ayah-card">
        <div class="ayah-loading hidden" id="ayah-loading"><div class="spinner"></div></div>
        <div class="ayah-arabic-text" id="ayah-arabic">â€”</div>
        <div class="ayah-translation-text" id="ayah-translation">â€”</div>
      </div>

      <div class="progress-area">
        <div class="progress-track" id="progress-track">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-times">
          <span id="time-current">0:00</span>
          <span id="time-total">0:00</span>
        </div>
      </div>

      <div class="controls-row">
        <button class="ctrl" id="btn-prev-surah" title="ĞŸÑ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ°Ñ ÑÑƒÑ€Ğ°">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="m11 17-5-5 5-5"/><line x1="19" y1="7" x2="19" y2="17" stroke-width="2.5"/>
          </svg>
        </button>
        <button class="ctrl" id="btn-prev-ayah" title="ĞŸÑ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğ¹ Ğ°ÑÑ‚">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="m15 18-6-6 6-6"/>
          </svg>
        </button>
        <button class="ctrl play" id="btn-play">
          <svg id="icon-play" viewBox="0 0 24 24" fill="currentColor">
            <path d="M8 5v14l11-7z"/>
          </svg>
          <svg id="icon-pause" viewBox="0 0 24 24" fill="currentColor" style="display:none">
            <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
          </svg>
        </button>
        <button class="ctrl" id="btn-next-ayah" title="Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ Ğ°ÑÑ‚">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="m9 18 6-6-6-6"/>
          </svg>
        </button>
        <button class="ctrl" id="btn-next-surah" title="Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ°Ñ ÑÑƒÑ€Ğ°">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="m13 17 5-5-5-5"/><line x1="5" y1="7" x2="5" y2="17" stroke-width="2.5"/>
          </svg>
        </button>
      </div>

      <div class="waveform hidden" id="waveform">
        <div class="wave-bar"></div>
        <div class="wave-bar"></div>
        <div class="wave-bar"></div>
        <div class="wave-bar"></div>
        <div class="wave-bar"></div>
      </div>

      <div class="sleep-row">
        <button class="sleep-btn" id="repeat-btn" onclick="toggleRepeat()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 2l4 4-4 4"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><path d="M7 22l-4-4 4-4"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/>
          </svg>
          <span id="repeat-btn-label">ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€</span>
        </button>
        <button class="sleep-btn" id="sleep-btn" onclick="openSleepModal()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 6v6l4 2"/>
          </svg>
          <span id="sleep-btn-label">Ğ¢Ğ°Ğ¹Ğ¼ĞµÑ€</span>
        </button>
      </div>

    </div><!-- /player-ui -->
  </div>

  <!-- â•â• SCREEN: RECITERS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen" id="screen-reciters">
    <div class="reciters-header">
      <div class="reciters-title" id="reciters-title">Ğ§Ñ‚ĞµÑ†Ñ‹</div>
      <div class="reciters-sub" id="reciters-sub">Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ³Ğ¾Ğ»Ğ¾Ñ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ»ÑƒÑˆĞ¸Ğ²Ğ°Ğ½Ğ¸Ñ</div>
    </div>
    <div class="reciters-grid" id="reciters-grid"></div>
  </div>

  <!-- â•â• SCREEN: PROFILE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen" id="screen-profile">
    <div class="profile-header">
      <div class="profile-avatar" id="profile-avatar"></div>
      <div class="profile-name"   id="profile-name">â€”</div>
      <div class="profile-username" id="profile-username"></div>
    </div>

    <div class="profile-section">
      <div class="profile-section-title" id="profile-sec-info">Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ</div>
      <div class="profile-card">
        <div class="profile-row">
          <div class="profile-row-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
          </div>
          <div class="profile-row-body">
            <div class="profile-row-label" id="lbl-userid">Telegram ID</div>
            <div class="profile-row-value" id="profile-id">â€”</div>
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-row-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <path d="M2 12h20M12 2a15 15 0 0 1 0 20M12 2a15 15 0 0 0 0 20"/>
            </svg>
          </div>
          <div class="profile-row-body">
            <div class="profile-row-label" id="lbl-lang">Ğ¯Ğ·Ñ‹Ğº</div>
            <div class="profile-row-value" id="profile-lang">â€”</div>
          </div>
        </div>
      </div>
    </div>

    <div class="profile-section" style="margin-top:14px;">
      <div class="profile-section-title" id="profile-sec-settings">ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸</div>
      <div class="profile-card">
        <div class="profile-row">
          <div class="profile-row-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2a3 3 0 0 1 3 3v7a3 3 0 0 1-6 0V5a3 3 0 0 1 3-3z"/>
              <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
            </svg>
          </div>
          <div class="profile-row-body">
            <div class="profile-row-label" id="lbl-reciter">Ğ§Ñ‚ĞµÑ†</div>
            <div class="profile-row-value" id="profile-reciter">â€”</div>
          </div>
        </div>
        <div class="profile-row">
          <div class="profile-row-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
            </svg>
          </div>
          <div class="profile-row-body">
            <div class="profile-row-label" id="lbl-theme">Ğ¢ĞµĞ¼Ğ°</div>
            <div class="profile-row-value" id="profile-theme">â€”</div>
          </div>
        </div>
      </div>
    </div>

    <div class="profile-section" style="margin-top:14px; padding-bottom:16px;">
      <div class="profile-card">
        <div class="profile-row" onclick="showScreen('favorites')" style="cursor:pointer;">
          <div class="profile-row-icon" style="background:rgba(224,92,92,0.12);">
            <svg viewBox="0 0 24 24" fill="#E05C5C" stroke="#E05C5C" stroke-width="1.5" style="width:16px;height:16px;">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
            </svg>
          </div>
          <div class="profile-row-body">
            <div class="profile-row-label" id="lbl-favs-count">Ğ˜Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ</div>
            <div class="profile-row-value" id="profile-favs-count">0</div>
          </div>
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" style="color:var(--text-3)">
            <path d="m9 18 6-6-6-6"/>
          </svg>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â• BOTTOM NAV â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <nav id="bottom-nav">
    <button class="nav-btn active" id="nav-list" onclick="showScreen('list')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <line x1="4" y1="6"  x2="20" y2="6"/>
        <line x1="4" y1="12" x2="20" y2="12"/>
        <line x1="4" y1="18" x2="13" y2="18"/>
      </svg>
      <span>Ğ¡ÑƒÑ€Ñ‹</span>
    </button>
    <button class="nav-btn" id="nav-player" onclick="showScreen('player')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <circle cx="12" cy="12" r="10"/>
        <polygon fill="currentColor" stroke="none" points="10,8 17,12 10,16"/>
      </svg>
      <span>ĞŸĞ»ĞµĞµÑ€</span>
    </button>
    <button class="nav-btn" id="nav-reciters" onclick="showScreen('reciters')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M12 2a3 3 0 0 1 3 3v7a3 3 0 0 1-6 0V5a3 3 0 0 1 3-3z"/>
        <path d="M19 10v2a7 7 0 0 1-14 0v-2M12 19v3M8 22h8"/>
      </svg>
      <span>Ğ§Ñ‚ĞµÑ†</span>
    </button>
    <button class="nav-btn" id="nav-profile" onclick="showScreen('profile')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
        <circle cx="12" cy="7" r="4"/>
      </svg>
      <span id="nav-profile-label">ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ</span>
    </button>
  </nav>

</div>
<audio id="audio-el" preload="none"></audio>

<!-- Sleep Timer Modal -->
<div class="sleep-modal" id="sleep-modal">
  <div class="sleep-sheet" id="sleep-sheet">
    <div class="sleep-drag-handle"></div>
    <div class="sleep-sheet-title" id="sleep-sheet-title">Ğ¢Ğ°Ğ¹Ğ¼ĞµÑ€ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ</div>
    <div class="sleep-dial-wrap">
      <svg id="sleep-svg" width="240" height="240" viewBox="0 0 260 260">
        <circle cx="130" cy="130" r="100" fill="none" stroke="var(--border)" stroke-width="14" stroke-linecap="round"/>
        <circle id="sleep-arc" cx="130" cy="130" r="100" fill="none" stroke="var(--primary)"
          stroke-width="14" stroke-linecap="round"
          stroke-dasharray="0 628.318" transform="rotate(-90 130 130)"/>
        <text id="sleep-min-val" x="130" y="122" text-anchor="middle"
          font-family="Inter,system-ui,sans-serif" font-size="52" font-weight="700"
          fill="var(--text)">0</text>
        <text id="sleep-min-lbl" x="130" y="152" text-anchor="middle"
          font-family="Inter,system-ui,sans-serif" font-size="15" font-weight="500"
          fill="var(--text-3)">Ğ¼Ğ¸Ğ½</text>
        <circle id="sleep-handle" cx="130" cy="30" r="11"
          fill="var(--primary)" stroke="var(--surface)" stroke-width="3"/>
      </svg>
    </div>
    <div class="sleep-eos-row">
      <button class="sleep-eos-btn" id="sleep-eos-btn" onclick="toggleEosSleep()">
        <span id="sleep-eos-label">ĞšĞ¾Ğ½ĞµÑ† ÑÑƒÑ€Ñ‹</span>
      </button>
    </div>
    <div class="sleep-actions">
      <button class="sleep-action-btn sleep-cancel" id="sleep-cancel-btn" onclick="closeSleepModal()">ĞÑ‚Ğ¼ĞµĞ½Ğ°</button>
      <button class="sleep-action-btn sleep-confirm" id="sleep-confirm-btn" onclick="confirmSleepTimer()">Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ</button>
    </div>
  </div>
</div>

<script>
// â”€â”€ Telegram WebApp â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const tg = window.Telegram?.WebApp;
if (tg) { tg.ready(); tg.expand(); }

// â”€â”€ Register user in DB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if (tg?.initData) {
  fetch('/api/register', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ initData: tg.initData }),
  }).catch(() => {});
}

// â”€â”€ Theme â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let _theme = localStorage.getItem('theme') || 'dark';
document.documentElement.setAttribute('data-theme', _theme);
function toggleTheme() {
  _theme = _theme === 'dark' ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', _theme);
  localStorage.setItem('theme', _theme);
  document.getElementById('btn-theme').textContent = _theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
  updateProfileValues();
}

// â”€â”€ i18n â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const I18N = {
  ru: {
    kicker:'Ğ¡Ğ²ÑÑ‰ĞµĞ½Ğ½Ñ‹Ğ¹ ĞšĞ¾Ñ€Ğ°Ğ½', search:'ĞŸĞ¾Ğ¸ÑĞº ÑÑƒÑ€Ñ‹â€¦',
    ayahs: n=>`${n} Ğ°ÑÑ‚Ğ¾Ğ²`, ayah_of:(n,t)=>`ĞÑÑ‚ ${n} Ğ¸Ğ· ${t}`,
    surah: n=>`Ğ¡ÑƒÑ€Ğ° ${n}`, reciters:'Ğ§Ñ‚ĞµÑ†Ñ‹', reciters_sub:'Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ³Ğ¾Ğ»Ğ¾Ñ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ»ÑƒÑˆĞ¸Ğ²Ğ°Ğ½Ğ¸Ñ',
    empty_title:'Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑÑƒÑ€Ñƒ', empty_sub:'ĞŸĞµÑ€ĞµĞ¹Ğ´Ğ¸Ñ‚Ğµ Ğº ÑĞ¿Ğ¸ÑĞºÑƒ ÑÑƒÑ€\nĞ¸ Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ»ÑĞ±ÑƒÑ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ»ÑƒÑˆĞ¸Ğ²Ğ°Ğ½Ğ¸Ñ',
    open_list:'ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº', loading:'Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°â€¦', error:'ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸',
    nav_list:'Ğ¡ÑƒÑ€Ñ‹', nav_player:'ĞŸĞ»ĞµĞµÑ€', nav_reciters:'Ğ§Ñ‚ĞµÑ†', not_found:'ĞĞ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾',
    mode_surah:'ĞŸĞ¾ ÑÑƒÑ€Ğ°Ğ¼', mode_ayah:'ĞŸĞ¾ Ğ°ÑÑ‚Ğ°Ğ¼',
    ayah_num: n=>`ĞÑÑ‚ ${n}`, full_surah:'ĞŸĞ¾Ğ»Ğ½Ğ°Ñ ÑÑƒÑ€Ğ°',
    nav_profile:'ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ',
    prof_info:'Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ', prof_settings:'ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸',
    prof_userid:'Telegram ID', prof_lang:'Ğ¯Ğ·Ñ‹Ğº', prof_reciter:'Ğ§Ñ‚ĞµÑ†', prof_theme:'Ğ¢ĞµĞ¼Ğ°',
    theme_dark:'Ğ¢Ñ‘Ğ¼Ğ½Ğ°Ñ', theme_light:'Ğ¡Ğ²ĞµÑ‚Ğ»Ğ°Ñ',
    lang_ru:'Ğ ÑƒÑÑĞºĞ¸Ğ¹ ğŸ‡·ğŸ‡º', lang_uz:"O'zbek ğŸ‡ºğŸ‡¿",
    sleep_btn:'Ğ¢Ğ°Ğ¹Ğ¼ĞµÑ€', sleep_off:'Ğ’Ñ‹ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ', sleep_end_of_surah:'ĞšĞ¾Ğ½ĞµÑ† ÑÑƒÑ€Ñ‹',
    sleep_min: m => `${m} Ğ¼Ğ¸Ğ½`, sleep_title:'Ğ¢Ğ°Ğ¹Ğ¼ĞµÑ€ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ',
    sleep_set:'Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ', sleep_cancel:'ĞÑ‚Ğ¼ĞµĞ½Ğ°', sleep_unit:'Ğ¼Ğ¸Ğ½',
    favs:'Ğ˜Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ', favs_sub:'Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½Ğ½Ñ‹Ğµ ÑÑƒÑ€Ñ‹ Ğ¸ Ğ°ÑÑ‚Ñ‹',
    favs_empty:'ĞĞµÑ‚ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾', favs_empty_sub:'ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ â™¥ Ğ² Ğ¿Ğ»ĞµĞµÑ€Ğµ Ğ¸Ğ»Ğ¸ ÑĞ¿Ğ¸ÑĞºĞµ',
    favs_count: n => `${n} ${n===1?'ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚':n<5?'ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ°':'ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²'}`,
    favs_label:'Ğ˜Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ', fav_ayah: (s,a) => `Ğ¡ÑƒÑ€Ğ° ${s} Â· ĞÑÑ‚ ${a}`,
    fav_surah: s => `Ğ¡ÑƒÑ€Ğ° ${s}`,
  },
  uz: {
    kicker:"Muqaddas Qur'on", search:'Sura qidirishâ€¦',
    ayahs: n=>`${n} oyat`, ayah_of:(n,t)=>`${n}/${t} oyat`,
    surah: n=>`Sura ${n}`, reciters:'Qorilar', reciters_sub:'Tinglash uchun ovoz tanlang',
    empty_title:'Sura tanlang', empty_sub:"Suralar ro'yxatiga o'ting\nva istalganini tanlang",
    open_list:"Ro'yxatni ochish", loading:'Yuklanmoqdaâ€¦', error:'Yuklash xatosi',
    nav_list:'Suralar', nav_player:'Pleer', nav_reciters:'Qori', not_found:'Hech narsa topilmadi',
    mode_surah:"Suralar bo'yicha", mode_ayah:"Oyatlar bo'yicha",
    ayah_num: n=>`${n}-oyat`, full_surah:"To'liq sura",
    nav_profile:'Profil',
    prof_info:'Ma\'lumot', prof_settings:'Sozlamalar',
    prof_userid:'Telegram ID', prof_lang:'Til', prof_reciter:'Qori', prof_theme:'Mavzu',
    theme_dark:'QoÊ»ngÊ»ir', theme_light:'Yorqin',
    lang_ru:'Ruscha ğŸ‡·ğŸ‡º', lang_uz:"O'zbek ğŸ‡ºğŸ‡¿",
    sleep_btn:'Taymer', sleep_off:"O'chirish", sleep_end_of_surah:'Sura oxiri',
    sleep_min: m => `${m} daq`, sleep_title:"O'chirish taymeri",
    sleep_set:"O'rnatish", sleep_cancel:'Bekor', sleep_unit:'daq',
    favs:"Sevimlilar", favs_sub:"Saqlangan suralar va oyatlar",
    favs_empty:"Sevimlilar yo'q", favs_empty_sub:"Pleyerda yoki ro'yxatda â™¥ bosing",
    favs_count: n => `${n} ta`,
    favs_label:"Sevimlilar", fav_ayah: (s,a) => `Sura ${s} Â· ${a}-oyat`,
    fav_surah: s => `Sura ${s}`,
  }
};
let _lang = localStorage.getItem('lang') ||
  (tg?.initDataUnsafe?.user?.language_code?.startsWith('uz') ? 'uz' : 'ru');
const t = k => I18N[_lang][k];
function setLang(lang) {
  _lang = lang;
  localStorage.setItem('lang', lang);
  applyI18n();
  renderList(document.getElementById('search-input').value);
  renderReciters();
  if (state.surah !== null) updatePlayerUI();
}
function applyI18n() {
  const l = I18N[_lang];
  document.getElementById('search-input').placeholder = l.search;
  document.getElementById('list-kicker').textContent = l.kicker;
  document.getElementById('nav-list').querySelector('span').textContent = l.nav_list;
  document.getElementById('nav-player').querySelector('span').textContent = l.nav_player;
  document.getElementById('nav-reciters').querySelector('span').textContent = l.nav_reciters;
  document.getElementById('reciters-title').textContent = l.reciters;
  document.getElementById('reciters-sub').textContent = l.reciters_sub;
  document.getElementById('player-empty-title').textContent = l.empty_title;
  document.getElementById('player-empty-sub').textContent = l.empty_sub;
  document.getElementById('btn-browse').textContent = l.open_list;
  document.getElementById('btn-lang-ru').classList.toggle('active', _lang === 'ru');
  document.getElementById('btn-lang-uz').classList.toggle('active', _lang === 'uz');
  document.getElementById('btn-theme').textContent = _theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
  document.getElementById('tab-surah').textContent = t('mode_surah');
  document.getElementById('tab-ayah').textContent  = t('mode_ayah');
  document.getElementById('nav-profile-label').textContent = t('nav_profile');
  document.getElementById('favs-title').textContent = t('favs');
  document.getElementById('favs-sub').textContent   = t('favs_sub');
  document.getElementById('lbl-favs-count').textContent = t('favs_label');
  // profile labels
  document.getElementById('profile-sec-info').textContent     = t('prof_info');
  document.getElementById('profile-sec-settings').textContent = t('prof_settings');
  document.getElementById('lbl-userid').textContent  = t('prof_userid');
  document.getElementById('lbl-lang').textContent    = t('prof_lang');
  document.getElementById('lbl-reciter').textContent = t('prof_reciter');
  document.getElementById('lbl-theme').textContent   = t('prof_theme');
  updateProfileValues();
}

function updateProfileValues() {
  const r = RECITERS.find(x => x.id === state.reciter);
  const reciterName = _lang === 'uz' ? RECITERS_UZ[r.id - 1] : r.name;
  document.getElementById('profile-reciter').textContent  = reciterName;
  document.getElementById('profile-lang').textContent     = t(_lang === 'ru' ? 'lang_ru' : 'lang_uz');
  document.getElementById('profile-theme').textContent    = t(_theme === 'dark' ? 'theme_dark' : 'theme_light');
  document.getElementById('profile-favs-count').textContent = t('favs_count')(_favs.length);
}

function renderProfile() {
  const user = tg?.initDataUnsafe?.user;
  const avatarEl = document.getElementById('profile-avatar');
  const nameEl   = document.getElementById('profile-name');
  const unameEl  = document.getElementById('profile-username');
  const idEl     = document.getElementById('profile-id');

  if (user) {
    const fullName = [user.first_name, user.last_name].filter(Boolean).join(' ');
    nameEl.textContent = fullName || 'ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ';
    unameEl.textContent = user.username ? '@' + user.username : '';
    idEl.textContent = user.id;
    if (user.photo_url) {
      avatarEl.innerHTML = `<img src="${user.photo_url}" alt="">`;
    } else {
      const initials = (user.first_name?.[0] || '') + (user.last_name?.[0] || '');
      avatarEl.textContent = initials.toUpperCase() || '?';
    }
  } else {
    // fallback for testing outside Telegram
    nameEl.textContent  = 'Ğ“Ğ¾ÑÑ‚ÑŒ';
    unameEl.textContent = '';
    idEl.textContent    = 'â€”';
    avatarEl.textContent = 'ğŸ‘¤';
  }
  updateProfileValues();
}

// Uzbek surah names
const UZ_NAMES = ["Fotiha","Baqara","Oli Imron","Niso","Moida","Anom","Arof","Anfol","Tavba","Yunus","Hud","Yusuf","Raad","Ibrohim","Hijr","Nahl","Isro","Kahf","Maryam","Toha","Anbiyo","Haj","Muminun","Nur","Furqon","Shuaro","Naml","Qasas","Ankabut","Rum","Luqmon","Sajda","Ahzob","Sabo","Fotir","Yosin","Soffot","Sod","Zumar","G\u02bBofir","Fussilat","Shuro","Zuxruf","Duxon","Josiya","Ahqof","Muhammad","Fath","Hujurot","Qof","Zoriyot","Tur","Najm","Qamar","Rohmon","Voqia","Hadid","Mujodala","Hashr","Mumtahana","Saf","Jumuah","Munofiqun","Tag\u02bBobun","Taloq","Tahrim","Mulk","Qalam","Haqqa","Maarij","Nuh","Jin","Muzzammil","Muddassir","Qiyomat","Inson","Mursalot","Naba","Noziot","Abasa","Takwir","Infitor","Mutaffifin","Inshiqoq","Buruj","Toriq","Alo","G\u02bBoshiya","Fajr","Balad","Shams","Layl","Zuho","Sharh","Tin","Alaq","Qadr","Bayyina","Zilzol","Odiyot","Qoria","Takosur","Asr","Humaza","Fil","Quraysh","Mo\u02bcun","Kavsar","Kofirun","Nasr","Masad","Ixlos","Falaq","Nos"];

const RECITERS_UZ = ["Mishary Rashid al-Afasiy","Abu Bakr ash-Shatriy","Nosir al-Qatamiy","Yosir ad-Dosariy","Honiy ar-Rifaiy"];

// â”€â”€ Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SURAHS = [
  {n:1,   ar:"Ø§Ù„ÙØ§ØªØ­Ø©",    name:"Al-Fatiha",      ru:"ĞÑ‚ĞºÑ€Ñ‹Ğ²Ğ°ÑÑ‰Ğ°Ñ",            ayahs:7},
  {n:2,   ar:"Ø§Ù„Ø¨Ù‚Ø±Ø©",     name:"Al-Baqara",       ru:"ĞšĞ¾Ñ€Ğ¾Ğ²Ğ°",                 ayahs:286},
  {n:3,   ar:"Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†",   name:"Ali 'Imran",      ru:"Ğ¡ĞµĞ¼ĞµĞ¹ÑÑ‚Ğ²Ğ¾ Ğ˜Ğ¼Ñ€Ğ°Ğ½Ğ°",       ayahs:200},
  {n:4,   ar:"Ø§Ù„Ù†Ø³Ø§Ø¡",     name:"An-Nisa",          ru:"Ğ–ĞµĞ½Ñ‰Ğ¸Ğ½Ñ‹",                ayahs:176},
  {n:5,   ar:"Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©",    name:"Al-Ma'ida",        ru:"Ğ¢Ñ€Ğ°Ğ¿ĞµĞ·Ğ°",                ayahs:120},
  {n:6,   ar:"Ø§Ù„Ø£Ù†Ø¹Ø§Ù…",    name:"Al-An'am",         ru:"Ğ¡ĞºĞ¾Ñ‚",                   ayahs:165},
  {n:7,   ar:"Ø§Ù„Ø£Ø¹Ø±Ø§Ù",    name:"Al-A'raf",         ru:"ĞŸÑ€ĞµĞ³Ñ€Ğ°Ğ´Ñ‹",               ayahs:206},
  {n:8,   ar:"Ø§Ù„Ø£Ù†ÙØ§Ù„",    name:"Al-Anfal",         ru:"Ğ”Ğ¾Ğ±Ñ‹Ñ‡Ğ°",                 ayahs:75},
  {n:9,   ar:"Ø§Ù„ØªÙˆØ¨Ø©",     name:"At-Tawba",         ru:"ĞŸĞ¾ĞºĞ°ÑĞ½Ğ¸Ğµ",               ayahs:129},
  {n:10,  ar:"ÙŠÙˆÙ†Ø³",       name:"Yunus",             ru:"Ğ˜Ğ¾Ğ½Ğ°",                   ayahs:109},
  {n:11,  ar:"Ù‡ÙˆØ¯",        name:"Hud",               ru:"Ğ¥ÑƒĞ´",                    ayahs:123},
  {n:12,  ar:"ÙŠÙˆØ³Ù",       name:"Yusuf",             ru:"Ğ˜Ğ¾ÑĞ¸Ñ„",                  ayahs:111},
  {n:13,  ar:"Ø§Ù„Ø±Ø¹Ø¯",      name:"Ar-Ra'd",           ru:"Ğ“Ñ€Ğ¾Ğ¼",                   ayahs:43},
  {n:14,  ar:"Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…",    name:"Ibrahim",           ru:"Ğ˜Ğ±Ñ€Ğ°Ğ³Ğ¸Ğ¼",                ayahs:52},
  {n:15,  ar:"Ø§Ù„Ø­Ø¬Ø±",      name:"Al-Hijr",           ru:"Ğ¥Ğ¸Ğ´Ğ¶Ñ€",                  ayahs:99},
  {n:16,  ar:"Ø§Ù„Ù†Ø­Ù„",      name:"An-Nahl",           ru:"ĞŸÑ‡Ñ‘Ğ»Ñ‹",                  ayahs:128},
  {n:17,  ar:"Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡",    name:"Al-Isra",           ru:"ĞĞ¾Ñ‡Ğ½Ğ¾Ğµ Ğ¿ÑƒÑ‚ĞµÑˆĞµÑÑ‚Ğ²Ğ¸Ğµ",     ayahs:111},
  {n:18,  ar:"Ø§Ù„ÙƒÙ‡Ù",      name:"Al-Kahf",           ru:"ĞŸĞµÑ‰ĞµÑ€Ğ°",                 ayahs:110},
  {n:19,  ar:"Ù…Ø±ÙŠÙ…",       name:"Maryam",            ru:"ĞœĞ°Ñ€Ğ¸Ñ",                  ayahs:98},
  {n:20,  ar:"Ø·Ù‡",         name:"Ta-Ha",             ru:"Ğ¢Ğ°-Ğ¥Ğ°",                  ayahs:135},
  {n:21,  ar:"Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡",   name:"Al-Anbiya",         ru:"ĞŸÑ€Ğ¾Ñ€Ğ¾ĞºĞ¸",                ayahs:112},
  {n:22,  ar:"Ø§Ù„Ø­Ø¬",       name:"Al-Hajj",           ru:"ĞŸĞ°Ğ»Ğ¾Ğ¼Ğ½Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾",          ayahs:78},
  {n:23,  ar:"Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†",   name:"Al-Mu'minun",       ru:"Ğ’ĞµÑ€ÑƒÑÑ‰Ğ¸Ğµ",               ayahs:118},
  {n:24,  ar:"Ø§Ù„Ù†ÙˆØ±",      name:"An-Nur",             ru:"Ğ¡Ğ²ĞµÑ‚",                   ayahs:64},
  {n:25,  ar:"Ø§Ù„ÙØ±Ù‚Ø§Ù†",    name:"Al-Furqan",         ru:"Ğ Ğ°Ğ·Ğ»Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ",             ayahs:77},
  {n:26,  ar:"Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡",    name:"Ash-Shu'ara",       ru:"ĞŸĞ¾ÑÑ‚Ñ‹",                  ayahs:227},
  {n:27,  ar:"Ø§Ù„Ù†Ù…Ù„",      name:"An-Naml",           ru:"ĞœÑƒÑ€Ğ°Ğ²ÑŒĞ¸",                ayahs:93},
  {n:28,  ar:"Ø§Ù„Ù‚ØµØµ",      name:"Al-Qasas",          ru:"Ğ Ğ°ÑÑĞºĞ°Ğ·",                ayahs:88},
  {n:29,  ar:"Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª",   name:"Al-'Ankabut",       ru:"ĞŸĞ°ÑƒĞº",                   ayahs:69},
  {n:30,  ar:"Ø§Ù„Ø±ÙˆÙ…",      name:"Ar-Rum",             ru:"Ğ Ğ¸Ğ¼Ğ»ÑĞ½Ğµ",                ayahs:60},
  {n:31,  ar:"Ù„Ù‚Ù…Ø§Ù†",      name:"Luqman",             ru:"Ğ›ÑƒĞºĞ¼Ğ°Ğ½",                 ayahs:34},
  {n:32,  ar:"Ø§Ù„Ø³Ø¬Ø¯Ø©",     name:"As-Sajda",           ru:"ĞŸĞ¾ĞºĞ»Ğ¾Ğ½",                 ayahs:30},
  {n:33,  ar:"Ø§Ù„Ø£Ø­Ø²Ø§Ø¨",    name:"Al-Ahzab",           ru:"Ğ¡Ğ¾ÑĞ·Ğ½Ğ¸ĞºĞ¸",               ayahs:73},
  {n:34,  ar:"Ø³Ø¨Ø£",        name:"Saba",               ru:"Ğ¡Ğ°Ğ±Ğ°",                   ayahs:54},
  {n:35,  ar:"ÙØ§Ø·Ø±",       name:"Fatir",              ru:"Ğ¢Ğ²Ğ¾Ñ€ĞµÑ†",                 ayahs:45},
  {n:36,  ar:"ÙŠØ³",         name:"Ya-Sin",             ru:"Ğ™Ğ°-Ğ¡Ğ¸Ğ½",                 ayahs:83},
  {n:37,  ar:"Ø§Ù„ØµØ§ÙØ§Øª",    name:"As-Saffat",          ru:"Ğ’Ñ‹ÑÑ‚Ñ€Ğ¾Ğ¸Ğ²ÑˆĞ¸ĞµÑÑ Ğ² Ñ€ÑĞ´Ñ‹",   ayahs:182},
  {n:38,  ar:"Øµ",          name:"Sad",                ru:"Ğ¡Ğ¾Ğ´",                    ayahs:88},
  {n:39,  ar:"Ø§Ù„Ø²Ù…Ø±",      name:"Az-Zumar",           ru:"Ğ¢Ğ¾Ğ»Ğ¿Ñ‹",                  ayahs:75},
  {n:40,  ar:"ØºØ§ÙØ±",       name:"Ghafir",             ru:"ĞŸÑ€Ğ¾Ñ‰Ğ°ÑÑ‰Ğ¸Ğ¹",              ayahs:85},
  {n:41,  ar:"ÙØµÙ„Øª",       name:"Fussilat",           ru:"Ğ Ğ°Ğ·ÑŠÑÑĞ½ĞµĞ½Ñ‹",             ayahs:54},
  {n:42,  ar:"Ø§Ù„Ø´ÙˆØ±Ù‰",     name:"Ash-Shura",          ru:"Ğ¡Ğ¾Ğ²ĞµÑ‚",                  ayahs:53},
  {n:43,  ar:"Ø§Ù„Ø²Ø®Ø±Ù",     name:"Az-Zukhruf",         ru:"Ğ£ĞºÑ€Ğ°ÑˆĞµĞ½Ğ¸Ñ",              ayahs:89},
  {n:44,  ar:"Ø§Ù„Ø¯Ø®Ø§Ù†",     name:"Ad-Dukhan",          ru:"Ğ”Ñ‹Ğ¼",                    ayahs:59},
  {n:45,  ar:"Ø§Ù„Ø¬Ø§Ø«ÙŠØ©",    name:"Al-Jathiya",         ru:"ĞšĞ¾Ğ»ĞµĞ½Ğ¾Ğ¿Ñ€ĞµĞºĞ»Ğ¾Ğ½Ñ‘Ğ½Ğ½Ñ‹Ğµ",     ayahs:37},
  {n:46,  ar:"Ø§Ù„Ø£Ø­Ù‚Ø§Ù",    name:"Al-Ahqaf",           ru:"Ğ‘Ğ°Ñ€Ñ…Ğ°Ğ½Ñ‹",                ayahs:35},
  {n:47,  ar:"Ù…Ø­Ù…Ø¯",       name:"Muhammad",           ru:"ĞœÑƒÑ…Ğ°Ğ¼Ğ¼Ğ°Ğ´",               ayahs:38},
  {n:48,  ar:"Ø§Ù„ÙØªØ­",      name:"Al-Fath",            ru:"ĞŸĞ¾Ğ±ĞµĞ´Ğ°",                 ayahs:29},
  {n:49,  ar:"Ø§Ù„Ø­Ø¬Ø±Ø§Øª",    name:"Al-Hujurat",         ru:"ĞŸĞ¾ĞºĞ¾Ğ¸",                  ayahs:18},
  {n:50,  ar:"Ù‚",          name:"Qaf",                ru:"ĞšĞ°Ñ„",                    ayahs:45},
  {n:51,  ar:"Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª",   name:"Adh-Dhariyat",       ru:"Ğ Ğ°ÑÑĞµĞ¸Ğ²Ğ°ÑÑ‰Ğ¸Ğµ",           ayahs:60},
  {n:52,  ar:"Ø§Ù„Ø·ÙˆØ±",      name:"At-Tur",             ru:"Ğ“Ğ¾Ñ€Ğ°",                   ayahs:49},
  {n:53,  ar:"Ø§Ù„Ù†Ø¬Ù…",      name:"An-Najm",            ru:"Ğ—Ğ²ĞµĞ·Ğ´Ğ°",                 ayahs:62},
  {n:54,  ar:"Ø§Ù„Ù‚Ù…Ø±",      name:"Al-Qamar",           ru:"Ğ›ÑƒĞ½Ğ°",                   ayahs:55},
  {n:55,  ar:"Ø§Ù„Ø±Ø­Ù…Ù†",     name:"Ar-Rahman",          ru:"ĞœĞ¸Ğ»Ğ¾ÑÑ‚Ğ¸Ğ²Ñ‹Ğ¹",             ayahs:78},
  {n:56,  ar:"Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©",    name:"Al-Waqi'a",          ru:"Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ",                ayahs:96},
  {n:57,  ar:"Ø§Ù„Ø­Ø¯ÙŠØ¯",     name:"Al-Hadid",           ru:"Ğ–ĞµĞ»ĞµĞ·Ğ¾",                 ayahs:29},
  {n:58,  ar:"Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©",   name:"Al-Mujadila",        ru:"ĞŸÑ€ĞµĞ¿Ğ¸Ñ€Ğ°ÑÑ‰Ğ°ÑÑÑ",          ayahs:22},
  {n:59,  ar:"Ø§Ù„Ø­Ø´Ø±",      name:"Al-Hashr",           ru:"Ğ¡Ğ±Ğ¾Ñ€",                   ayahs:24},
  {n:60,  ar:"Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©",   name:"Al-Mumtahina",       ru:"Ğ˜ÑĞ¿Ñ‹Ñ‚ÑƒĞµĞ¼Ğ°Ñ",             ayahs:13},
  {n:61,  ar:"Ø§Ù„ØµÙ",       name:"As-Saff",            ru:"Ğ ÑĞ´Ñ‹",                   ayahs:14},
  {n:62,  ar:"Ø§Ù„Ø¬Ù…Ø¹Ø©",     name:"Al-Jumu'a",          ru:"ĞŸÑÑ‚Ğ½Ğ¸Ñ†Ğ°",                ayahs:11},
  {n:63,  ar:"Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†",  name:"Al-Munafiqun",       ru:"Ğ›Ğ¸Ñ†ĞµĞ¼ĞµÑ€Ñ‹",               ayahs:11},
  {n:64,  ar:"Ø§Ù„ØªØºØ§Ø¨Ù†",    name:"At-Taghabun",        ru:"Ğ’Ğ·Ğ°Ğ¸Ğ¼Ğ½Ğ¾Ğµ Ğ¾Ğ±Ğ²Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ",     ayahs:18},
  {n:65,  ar:"Ø§Ù„Ø·Ù„Ø§Ù‚",     name:"At-Talaq",           ru:"Ğ Ğ°Ğ·Ğ²Ğ¾Ğ´",                 ayahs:12},
  {n:66,  ar:"Ø§Ù„ØªØ­Ø±ÙŠÙ…",    name:"At-Tahrim",          ru:"Ğ—Ğ°Ğ¿Ñ€ĞµÑ‚",                 ayahs:12},
  {n:67,  ar:"Ø§Ù„Ù…Ù„Ùƒ",      name:"Al-Mulk",            ru:"Ğ’Ğ»Ğ°ÑÑ‚ÑŒ",                 ayahs:30},
  {n:68,  ar:"Ø§Ù„Ù‚Ù„Ù…",      name:"Al-Qalam",           ru:"ĞŸĞµÑ€Ğ¾",                   ayahs:52},
  {n:69,  ar:"Ø§Ù„Ø­Ø§Ù‚Ø©",     name:"Al-Haqqa",           ru:"ĞĞµĞ¾Ñ‚Ğ²Ñ€Ğ°Ñ‚Ğ¸Ğ¼Ğ¾Ğµ",           ayahs:52},
  {n:70,  ar:"Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬",    name:"Al-Ma'arij",         ru:"Ğ¡Ñ‚ÑƒĞ¿ĞµĞ½Ğ¸",                ayahs:44},
  {n:71,  ar:"Ù†ÙˆØ­",        name:"Nuh",                ru:"ĞÑƒÑ…",                    ayahs:28},
  {n:72,  ar:"Ø§Ù„Ø¬Ù†",       name:"Al-Jinn",            ru:"Ğ”Ğ¶Ğ¸Ğ½Ğ½Ñ‹",                 ayahs:28},
  {n:73,  ar:"Ø§Ù„Ù…Ø²Ù…Ù„",     name:"Al-Muzzammil",       ru:"Ğ—Ğ°ĞºÑƒÑ‚Ğ°Ğ²ÑˆĞ¸Ğ¹ÑÑ",           ayahs:20},
  {n:74,  ar:"Ø§Ù„Ù…Ø¯Ø«Ø±",     name:"Al-Muddaththir",     ru:"Ğ—Ğ°Ğ²ĞµÑ€Ğ½ÑƒĞ²ÑˆĞ¸Ğ¹ÑÑ",          ayahs:56},
  {n:75,  ar:"Ø§Ù„Ù‚ÙŠØ§Ù…Ø©",    name:"Al-Qiyama",          ru:"Ğ’Ğ¾ÑĞºÑ€ĞµÑĞµĞ½Ğ¸Ğµ",            ayahs:40},
  {n:76,  ar:"Ø§Ù„Ø¥Ù†Ø³Ø§Ù†",    name:"Al-Insan",           ru:"Ğ§ĞµĞ»Ğ¾Ğ²ĞµĞº",                ayahs:31},
  {n:77,  ar:"Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª",   name:"Al-Mursalat",        ru:"ĞŸĞ¾ÑÑ‹Ğ»Ğ°ĞµĞ¼Ñ‹Ğµ",             ayahs:50},
  {n:78,  ar:"Ø§Ù„Ù†Ø¨Ø£",      name:"An-Naba",            ru:"Ğ’ĞµÑÑ‚ÑŒ",                  ayahs:40},
  {n:79,  ar:"Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª",   name:"An-Nazi'at",         ru:"Ğ˜ÑÑ‚Ğ¾Ñ€Ğ³Ğ°ÑÑ‰Ğ¸Ğµ",            ayahs:46},
  {n:80,  ar:"Ø¹Ø¨Ø³",        name:"'Abasa",             ru:"ĞĞ°Ñ…Ğ¼ÑƒÑ€Ğ¸Ğ»ÑÑ",             ayahs:42},
  {n:81,  ar:"Ø§Ù„ØªÙƒÙˆÙŠØ±",    name:"At-Takwir",          ru:"Ğ¡ĞºÑ€ÑƒÑ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ",            ayahs:29},
  {n:82,  ar:"Ø§Ù„Ø§Ù†ÙØ·Ø§Ø±",   name:"Al-Infitar",         ru:"Ğ Ğ°ÑĞºĞ°Ğ»Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ",           ayahs:19},
  {n:83,  ar:"Ø§Ù„Ù…Ø·ÙÙÙŠÙ†",   name:"Al-Mutaffifin",      ru:"ĞĞ±Ğ²ĞµÑˆĞ¸Ğ²Ğ°ÑÑ‰Ğ¸Ğµ",           ayahs:36},
  {n:84,  ar:"Ø§Ù„Ø§Ù†Ø´Ù‚Ø§Ù‚",   name:"Al-Inshiqaq",        ru:"Ğ Ğ°Ğ·Ñ€Ñ‹Ğ²",                 ayahs:25},
  {n:85,  ar:"Ø§Ù„Ø¨Ø±ÙˆØ¬",     name:"Al-Buruj",           ru:"Ğ¡Ğ¾Ğ·Ğ²ĞµĞ·Ğ´Ğ¸Ñ",              ayahs:22},
  {n:86,  ar:"Ø§Ù„Ø·Ø§Ø±Ù‚",     name:"At-Tariq",           ru:"ĞĞ¾Ñ‡Ğ½Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ°Ğ½Ğ½Ğ¸Ğº",        ayahs:17},
  {n:87,  ar:"Ø§Ù„Ø£Ø¹Ù„Ù‰",     name:"Al-A'la",            ru:"Ğ’ÑĞµĞ²Ñ‹ÑˆĞ½Ğ¸Ğ¹",              ayahs:19},
  {n:88,  ar:"Ø§Ù„ØºØ§Ø´ÙŠØ©",    name:"Al-Ghashiya",        ru:"ĞŸĞ¾ĞºÑ€Ñ‹Ğ²Ğ°ÑÑ‰ĞµĞµ",            ayahs:26},
  {n:89,  ar:"Ø§Ù„ÙØ¬Ø±",      name:"Al-Fajr",            ru:"Ğ—Ğ°Ñ€Ñ",                   ayahs:30},
  {n:90,  ar:"Ø§Ù„Ø¨Ù„Ø¯",      name:"Al-Balad",           ru:"Ğ“Ğ¾Ñ€Ğ¾Ğ´",                  ayahs:20},
  {n:91,  ar:"Ø§Ù„Ø´Ù…Ø³",      name:"Ash-Shams",          ru:"Ğ¡Ğ¾Ğ»Ğ½Ñ†Ğµ",                 ayahs:15},
  {n:92,  ar:"Ø§Ù„Ù„ÙŠÙ„",      name:"Al-Layl",            ru:"ĞĞ¾Ñ‡ÑŒ",                   ayahs:21},
  {n:93,  ar:"Ø§Ù„Ø¶Ø­Ù‰",      name:"Ad-Duha",            ru:"Ğ£Ñ‚Ñ€Ğ¾",                   ayahs:11},
  {n:94,  ar:"Ø§Ù„Ø´Ø±Ø­",      name:"Ash-Sharh",          ru:"Ğ Ğ°ÑĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ Ğ³Ñ€ÑƒĞ´Ğ¸",        ayahs:8},
  {n:95,  ar:"Ø§Ù„ØªÙŠÙ†",      name:"At-Tin",             ru:"Ğ¡Ğ¼Ğ¾ĞºĞ¾Ğ²Ğ½Ğ¸Ñ†Ğ°",             ayahs:8},
  {n:96,  ar:"Ø§Ù„Ø¹Ù„Ù‚",      name:"Al-'Alaq",           ru:"Ğ¡Ğ³ÑƒÑÑ‚Ğ¾Ğº",                ayahs:19},
  {n:97,  ar:"Ø§Ù„Ù‚Ø¯Ø±",      name:"Al-Qadr",            ru:"ĞŸÑ€ĞµĞ´Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ",        ayahs:5},
  {n:98,  ar:"Ø§Ù„Ø¨ÙŠÙ†Ø©",     name:"Al-Bayyina",         ru:"Ğ¯ÑĞ½Ğ¾Ğµ Ğ·Ğ½Ğ°Ğ¼ĞµĞ½Ğ¸Ğµ",         ayahs:8},
  {n:99,  ar:"Ø§Ù„Ø²Ù„Ø²Ù„Ø©",    name:"Az-Zalzala",         ru:"Ğ—ĞµĞ¼Ğ»ĞµÑ‚Ñ€ÑÑĞµĞ½Ğ¸Ğµ",          ayahs:8},
  {n:100, ar:"Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª",   name:"Al-'Adiyat",         ru:"Ğ¡ĞºĞ°Ñ‡ÑƒÑ‰Ğ¸Ğµ",               ayahs:11},
  {n:101, ar:"Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©",    name:"Al-Qari'a",          ru:"Ğ¡Ğ¾ĞºÑ€ÑƒÑˆĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ",         ayahs:11},
  {n:102, ar:"Ø§Ù„ØªÙƒØ§Ø«Ø±",    name:"At-Takathur",        ru:"Ğ¡Ñ‚Ñ€Ğ°ÑÑ‚ÑŒ Ğº ÑƒĞ¼Ğ½Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ",    ayahs:8},
  {n:103, ar:"Ø§Ù„Ø¹ØµØ±",      name:"Al-'Asr",            ru:"Ğ’Ñ€ĞµĞ¼Ñ",                  ayahs:3},
  {n:104, ar:"Ø§Ù„Ù‡Ù…Ø²Ø©",     name:"Al-Humaza",          ru:"Ğ¥ÑƒĞ»Ğ¸Ñ‚ĞµĞ»ÑŒ",               ayahs:9},
  {n:105, ar:"Ø§Ù„ÙÙŠÙ„",      name:"Al-Fil",             ru:"Ğ¡Ğ»Ğ¾Ğ½",                   ayahs:5},
  {n:106, ar:"Ù‚Ø±ÙŠØ´",       name:"Quraysh",            ru:"ĞšÑƒÑ€Ğ°Ğ¹ÑˆĞ¸Ñ‚Ñ‹",              ayahs:4},
  {n:107, ar:"Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†",    name:"Al-Ma'un",           ru:"ĞœĞµĞ»ĞºĞ°Ñ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒ",          ayahs:7},
  {n:108, ar:"Ø§Ù„ÙƒÙˆØ«Ø±",     name:"Al-Kawthar",         ru:"Ğ˜Ğ·Ğ¾Ğ±Ğ¸Ğ»Ğ¸Ğµ",               ayahs:3},
  {n:109, ar:"Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†",   name:"Al-Kafirun",         ru:"ĞĞµĞ²ĞµÑ€ÑƒÑÑ‰Ğ¸Ğµ",             ayahs:6},
  {n:110, ar:"Ø§Ù„Ù†ØµØ±",      name:"An-Nasr",            ru:"ĞŸĞ¾Ğ¼Ğ¾Ñ‰ÑŒ",                 ayahs:3},
  {n:111, ar:"Ø§Ù„Ù…Ø³Ø¯",      name:"Al-Masad",           ru:"ĞŸĞ°Ğ»ÑŒĞ¼Ğ¾Ğ²Ñ‹Ğµ Ğ²Ğ¾Ğ»Ğ¾ĞºĞ½Ğ°",      ayahs:5},
  {n:112, ar:"Ø§Ù„Ø¥Ø®Ù„Ø§Øµ",    name:"Al-Ikhlas",          ru:"ĞÑ‡Ğ¸Ñ‰ĞµĞ½Ğ¸Ğµ Ğ²ĞµÑ€Ñ‹",          ayahs:4},
  {n:113, ar:"Ø§Ù„ÙÙ„Ù‚",      name:"Al-Falaq",           ru:"Ğ Ğ°ÑÑĞ²ĞµÑ‚",                ayahs:5},
  {n:114, ar:"Ø§Ù„Ù†Ø§Ø³",      name:"An-Nas",             ru:"Ğ›ÑĞ´Ğ¸",                   ayahs:6},
];

const RECITERS = [
  {id:1, name:"ĞœĞ¸ÑˆĞ°Ñ€Ğ¸ Ğ Ğ°ÑˆĞ¸Ğ´ ĞĞ»ÑŒ-ĞÑ„Ğ°ÑĞ¸",   abbr:"ĞœĞ"},
  {id:2, name:"ĞĞ±Ñƒ Ğ‘Ğ°ĞºÑ€ ĞÑˆ-Ğ¨Ğ°Ñ‚Ñ€Ğ¸",        abbr:"ĞĞ¨"},
  {id:3, name:"ĞĞ°ÑĞµÑ€ ĞĞ»ÑŒ-ĞšĞ°Ñ‚Ğ°Ğ¼Ğ¸",          abbr:"ĞĞš"},
  {id:4, name:"Ğ¯ÑĞ¸Ñ€ ĞĞ»ÑŒ-Ğ”Ğ¾ÑĞ°Ñ€Ğ¸",           abbr:"Ğ¯Ğ”"},
  {id:5, name:"Ğ¥Ğ°Ğ½Ğ¸ ĞÑ€-Ğ Ğ¸Ñ„Ğ°Ğ¸",            abbr:"Ğ¥Ğ "},
];

// Sample ayah texts for Al-Fatiha
const FATIHA = [
  {ar:"Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„ÙÙ‘Ù‡Ù Ù±Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ù±Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù",               ru:"Ğ’Ğ¾ Ğ¸Ğ¼Ñ ĞĞ»Ğ»Ğ°Ñ…Ğ°, ĞœĞ¸Ğ»Ğ¾ÑÑ‚Ğ¸Ğ²Ğ¾Ğ³Ğ¾, ĞœĞ¸Ğ»Ğ¾ÑĞµÑ€Ğ´Ğ½Ğ¾Ğ³Ğ¾"},
  {ar:"Ù±Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù Ø±ÙØ¨ÙÙ‘ Ù±Ù„Ù’Ø¹ÙÙ°Ù„ÙÙ…ÙÙŠÙ†Ù",                 ru:"Ğ¥Ğ²Ğ°Ğ»Ğ° ĞĞ»Ğ»Ğ°Ñ…Ñƒ, Ğ“Ğ¾ÑĞ¿Ğ¾Ğ´Ñƒ Ğ¼Ğ¸Ñ€Ğ¾Ğ²"},
  {ar:"Ù±Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ù±Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù",                               ru:"ĞœĞ¸Ğ»Ğ¾ÑÑ‚Ğ¸Ğ²Ğ¾Ğ¼Ñƒ, ĞœĞ¸Ğ»Ğ¾ÑĞµÑ€Ğ´Ğ½Ğ¾Ğ¼Ñƒ"},
  {ar:"Ù…ÙÙ°Ù„ÙÙƒÙ ÙŠÙÙˆÙ’Ù…Ù Ù±Ù„Ø¯ÙÙ‘ÙŠÙ†Ù",                               ru:"Ğ’Ğ»Ğ°Ğ´Ñ‹ĞºĞµ Ğ¡ÑƒĞ´Ğ½Ğ¾Ğ³Ğ¾ Ğ´Ğ½Ñ"},
  {ar:"Ø¥ÙÙŠÙÙ‘Ø§ÙƒÙ Ù†ÙØ¹Ù’Ø¨ÙØ¯Ù ÙˆÙØ¥ÙÙŠÙÙ‘Ø§ÙƒÙ Ù†ÙØ³Ù’ØªÙØ¹ÙÙŠÙ†Ù",             ru:"Ğ¢ĞµĞ±Ğµ Ğ¾Ğ´Ğ½Ğ¾Ğ¼Ñƒ Ğ¼Ñ‹ Ğ¿Ğ¾ĞºĞ»Ğ¾Ğ½ÑĞµĞ¼ÑÑ Ğ¸ Ğ¢ĞµĞ±Ñ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾ÑĞ¸Ğ¼ Ğ¾ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰Ğ¸"},
  {ar:"Ù±Ù‡Ù’Ø¯ÙÙ†ÙØ§ Ù±Ù„ØµÙÙ‘Ø±ÙÙ°Ø·Ù Ù±Ù„Ù’Ù…ÙØ³Ù’ØªÙÙ‚ÙÙŠÙ…Ù",                   ru:"Ğ’ĞµĞ´Ğ¸ Ğ½Ğ°Ñ Ğ¿Ñ€ÑĞ¼Ñ‹Ğ¼ Ğ¿ÑƒÑ‚Ñ‘Ğ¼"},
  {ar:"ØµÙØ±ÙÙ°Ø·Ù Ù±Ù„ÙÙ‘Ø°ÙÙŠÙ†Ù Ø£ÙÙ†Ù’Ø¹ÙÙ…Ù’ØªÙ Ø¹ÙÙ„ÙÙŠÙ’Ù‡ÙÙ…Ù’ ØºÙÙŠÙ’Ø±Ù Ù±Ù„Ù’Ù…ÙØºÙ’Ø¶ÙÙˆØ¨Ù Ø¹ÙÙ„ÙÙŠÙ’Ù‡ÙÙ…Ù’ ÙˆÙÙ„ÙØ§ Ù±Ù„Ø¶ÙÙ‘Ø¢Ù„ÙÙ‘ÙŠÙ†Ù", ru:"ĞŸÑƒÑ‚Ñ‘Ğ¼ Ñ‚ĞµÑ…, ĞºĞ¾Ğ³Ğ¾ Ğ¢Ñ‹ Ğ¾Ğ±Ğ»Ğ°Ğ³Ğ¾Ğ´ĞµÑ‚ĞµĞ»ÑŒÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ», Ğ½Ğµ Ñ‚ĞµÑ…, Ğ½Ğ° ĞºĞ¾Ğ³Ğ¾ Ğ¿Ğ°Ğ» Ğ³Ğ½ĞµĞ², Ğ¸ Ğ½Ğµ Ğ·Ğ°Ğ±Ğ»ÑƒĞ´ÑˆĞ¸Ñ…"},
];

// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const state = {
  screen:   'list',
  surah:    null,
  ayah:     1,
  reciter:  parseInt(localStorage.getItem('reciter') || '1'),
  playing:  false,
  progress: 0,
  mode:     'surah', // 'surah' | 'ayah'
  repeat:   false,
};

// â”€â”€ Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showScreen(name) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('screen-' + name).classList.add('active');
  const navId = (name === 'ayah-list' || name === 'favorites') ? 'nav-profile' : 'nav-' + name;
  const navEl = document.getElementById(navId);
  if (navEl) navEl.classList.add('active');
  state.screen = name;
  if (name === 'profile')   renderProfile();
  if (name === 'favorites') renderFavorites();
}

function setMode(mode) {
  state.mode = mode;
  document.getElementById('tab-surah').classList.toggle('active', mode === 'surah');
  document.getElementById('tab-ayah').classList.toggle('active',  mode === 'ayah');
}

function openSurahForAyahs(n) {
  const s = SURAHS[n - 1];
  document.getElementById('ayah-list-title').textContent = getSurahName(s);
  document.getElementById('ayah-list-ar').textContent    = s.ar;
  const container = document.getElementById('ayah-list');
  container.innerHTML = Array.from({length: s.ayahs}, (_, i) => {
    const num   = i + 1;
    const faved = isFav('ayah', n, num);
    return `
    <div class="ayah-item${state.surah === n && state.ayah === num ? ' playing' : ''}" onclick="openAyah(${n}, ${num})">
      <div class="surah-num-badge">${num}</div>
      <div class="ayah-item-info">
        <div class="ayah-item-num">${t('ayah_num')(num)}</div>
      </div>
      <button class="heart-btn${faved?' fav':''}" onclick="toggleFavAyah(${n},${num},event)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
        </svg>
      </button>
    </div>`;
  }).join('');
  if (state.screen !== 'ayah-list') showScreen('ayah-list');
}

function openAyah(surah, ayah) {
  stopPlayback();
  state.surah = surah;
  state.ayah  = ayah;
  state.progress = 0;
  state.playing = true;
  showScreen('player');
  updatePlayerUI();
  renderList(document.getElementById('search-input').value);
}

// â”€â”€ Surah List â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getSurahName(s) {
  return _lang === 'uz' ? UZ_NAMES[s.n - 1] : s.ru;
}
function renderList(query = '') {
  const q = query.trim().toLowerCase();
  const filtered = SURAHS.filter(s =>
    !q ||
    s.ru.toLowerCase().includes(q) ||
    UZ_NAMES[s.n-1].toLowerCase().includes(q) ||
    s.name.toLowerCase().includes(q) ||
    String(s.n).startsWith(q) ||
    s.ar.includes(query.trim())
  );
  const container = document.getElementById('surah-list');
  if (!filtered.length) {
    container.innerHTML = `<div class="empty-state">${t('not_found')}</div>`;
    return;
  }
  container.innerHTML = filtered.map(s => {
    const faved = isFav('surah', s.n, null);
    return `
    <div class="surah-item${state.surah === s.n ? ' playing' : ''}" onclick="openSurah(${s.n})">
      <div class="surah-num-badge">${s.n}</div>
      <div class="surah-info">
        <div class="surah-name-ru">${getSurahName(s)}</div>
        <div class="surah-name-en">${s.name}</div>
      </div>
      <div class="surah-right" style="display:flex;align-items:center;gap:6px;">
        <div style="text-align:right;">
          <span class="surah-name-ar">${s.ar}</span>
          <div class="surah-ayah-count">${t('ayahs')(s.ayahs)}</div>
        </div>
        <button class="heart-btn${faved?' fav':''}" onclick="toggleFavSurah(${s.n},event)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
          </svg>
        </button>
      </div>
    </div>`;
  }).join('');
}

function openSurah(n) {
  if (state.mode === 'ayah') {
    openSurahForAyahs(n);
    return;
  }
  stopPlayback();
  state.surah = n;
  state.ayah  = 1;
  state.progress = 0;
  state.playing = true;
  showScreen('player');
  updatePlayerUI();
  renderList(document.getElementById('search-input').value);
}

// â”€â”€ Player â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updatePlayerUI() {
  const empty  = document.getElementById('player-empty');
  const ui     = document.getElementById('player-ui');

  if (state.surah === null) {
    empty.style.display = 'flex';
    ui.style.display    = 'none';
    return;
  }
  empty.style.display = 'none';
  ui.style.display    = 'flex';

  // Sync play/pause UI state
  document.getElementById('icon-play').style.display  = state.playing ? 'none'  : 'block';
  document.getElementById('icon-pause').style.display = state.playing ? 'block' : 'none';
  document.getElementById('waveform').classList.toggle('hidden', !state.playing);
  setDiscWaves(state.playing);

  const s = SURAHS[state.surah - 1];
  const r = RECITERS.find(x => x.id === state.reciter);

  const reciterName = _lang === 'uz' ? RECITERS_UZ[r.id - 1] : r.name;
  document.getElementById('player-title').textContent    = `${s.name} â€” ${getSurahName(s)}`;
  document.getElementById('disc-arabic').textContent     = s.ar;
  document.getElementById('disc-label').textContent      = t('surah')(s.n);
  document.getElementById('player-reciter').textContent  = reciterName;

  const dotsEl = document.getElementById('ayah-dots');
  if (s.ayahs <= 10) {
    dotsEl.innerHTML = Array.from({length: s.ayahs}, (_, i) =>
      `<div class="ayah-dot${i + 1 === state.ayah ? ' active' : ''}"></div>`
    ).join('');
    dotsEl.style.fontSize = ''; dotsEl.style.color = ''; dotsEl.style.fontWeight = '';
  } else {
    dotsEl.textContent = t('ayah_of')(state.ayah, s.ayahs);
    dotsEl.style.fontSize = '12px'; dotsEl.style.color = 'var(--text-3)'; dotsEl.style.fontWeight = '500';
  }

  document.getElementById('btn-prev-surah').disabled = s.n <= 1;
  document.getElementById('btn-next-surah').disabled = s.n >= 114;
  document.getElementById('btn-prev-ayah').disabled  = state.ayah <= 1;
  document.getElementById('btn-next-ayah').disabled  = state.ayah >= s.ayahs;
  updateProgress(state.progress);

  // Surah vs ayah mode
  const playerUi = document.getElementById('player-ui');
  if (state.mode === 'surah') {
    playerUi.classList.add('mode-surah');
    document.getElementById('player-reciter').textContent = reciterName;
    loadSurahAudio(state.surah, state.reciter);
  } else {
    playerUi.classList.remove('mode-surah');
    loadAyahData(state.surah, state.ayah, state.reciter);
  }
  updateFavBtn();
}

// â”€â”€ Real Audio â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const audioEl = document.getElementById('audio-el');
const _cache  = {};

async function loadSurahAudio(surah, reciter) {
  const ck = `s:${surah}:${reciter}`;
  if (_cache[ck]) { applyAyahData(_cache[ck]); return; }
  try {
    const res  = await fetch(`https://quranapi.pages.dev/api/${surah}.json`);
    const data = await res.json();
    const audioUrl = data.audio?.[String(reciter)]?.url || '';
    _cache[ck] = { audioUrl, arabic: '', translation: '' };
    applyAyahData(_cache[ck]);
  } catch(e) { console.error('loadSurahAudio', e); }
}

async function loadAyahData(surah, ayah, reciter) {
  const langEdition = _lang === 'uz' ? 'uz.sodik' : 'ru.kuliev';
  const ck = `${surah}:${ayah}:${reciter}:${_lang}`;
  if (_cache[ck]) { applyAyahData(_cache[ck]); return; }

  document.getElementById('ayah-loading').classList.remove('hidden');
  document.getElementById('ayah-arabic').style.visibility = 'hidden';
  document.getElementById('ayah-translation').style.visibility = 'hidden';
  try {
    const [apiRes, trRes] = await Promise.all([
      fetch(`https://quranapi.pages.dev/api/${surah}/${ayah}.json`),
      fetch(`https://api.alquran.cloud/v1/ayah/${surah}:${ayah}/${langEdition}`)
    ]);
    const [apiData, trData] = await Promise.all([apiRes.json(), trRes.json()]);
    let arabic = apiData.arabic2 || apiData.arabic1 || '';
    if (Array.isArray(arabic)) arabic = arabic[ayah - 1] || '';
    const audioUrl = apiData.audio?.[String(reciter)]?.url || '';
    const translation = trData.data?.text || '';
    _cache[ck] = { audioUrl, arabic, translation };
    applyAyahData(_cache[ck]);
  } catch(e) {
    document.getElementById('ayah-translation').textContent = t('error');
    document.getElementById('ayah-loading').classList.add('hidden');
    document.getElementById('ayah-arabic').style.visibility = '';
    document.getElementById('ayah-translation').style.visibility = '';
  }
}

function applyAyahData({ audioUrl, arabic, translation }) {
  document.getElementById('ayah-loading').classList.add('hidden');
  document.getElementById('ayah-arabic').textContent = arabic || 'â€”';
  document.getElementById('ayah-translation').textContent = translation || 'â€”';
  document.getElementById('ayah-arabic').style.visibility = '';
  document.getElementById('ayah-translation').style.visibility = '';
  if (state.playing && audioUrl) {
    audioEl.src = audioUrl;
    audioEl.play();
  } else if (!state.playing) {
    audioEl.src = audioUrl; // preload src for quick play
  }
}

audioEl.addEventListener('timeupdate', () => {
  if (!audioEl.duration) return;
  state.progress = (audioEl.currentTime / audioEl.duration) * 100;
  document.getElementById('progress-fill').style.width = state.progress + '%';
  document.getElementById('time-current').textContent = formatTime(Math.floor(audioEl.currentTime));
});
audioEl.addEventListener('loadedmetadata', () => {
  document.getElementById('time-total').textContent = formatTime(Math.floor(audioEl.duration));
});
function toggleRepeat() {
  state.repeat = !state.repeat;
  const btn = document.getElementById('repeat-btn');
  const label = document.getElementById('repeat-btn-label');
  if (btn) btn.classList.toggle('active', state.repeat);
  if (label) label.textContent = state.repeat
    ? (_lang === 'uz' ? 'Takror' : 'ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€')
    : (_lang === 'uz' ? 'Takror' : 'ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€');
}

audioEl.addEventListener('ended', () => {
  if (state.repeat) { audioEl.currentTime = 0; audioEl.play(); return; }
  if (state.mode === 'surah') {
    // "end of surah" sleep timer fires here
    if (_sleepMinutes === 'surah') { stopPlayback(); clearSleepTimer(true); return; }
    // auto-advance to next surah
    const nextSurah = state.surah + 1;
    if (nextSurah > 114) { stopPlayback(); return; }
    state.surah = nextSurah;
    state.ayah  = 1;
    state.progress = 0;
    state.playing = true;
    updatePlayerUI();
    renderList(document.getElementById('search-input').value);
    return;
  }
  const s = SURAHS[state.surah - 1];
  if (state.ayah < s.ayahs) {
    // "end of surah" in ayah mode â€” check after last ayah
    state.ayah++; state.progress = 0; updatePlayerUI();
    const ck = `${state.surah}:${state.ayah}:${state.reciter}:${_lang}`;
    if (_cache[ck]?.audioUrl) { audioEl.src = _cache[ck].audioUrl; audioEl.play(); }
  } else {
    // last ayah of surah finished
    if (_sleepMinutes === 'surah') { stopPlayback(); clearSleepTimer(true); return; }
    stopPlayback();
  }
});

function updateProgress(pct) {
  document.getElementById('progress-fill').style.width = pct + '%';
}
function formatTime(s) {
  return `${Math.floor(s/60)}:${String(s%60).padStart(2,'0')}`;
}

let _fadingTimer = null;
function setDiscWaves(playing) {
  const c = document.getElementById('disc-container');
  if (!c) return;
  clearTimeout(_fadingTimer);
  if (playing) {
    c.classList.remove('fading');
    c.classList.add('playing');
  } else {
    c.classList.remove('playing');
    c.classList.add('fading');
    _fadingTimer = setTimeout(() => c.classList.remove('fading'), 1600);
  }
}

function togglePlay() {
  if (!state.surah) return;
  state.playing = !state.playing;
  if (state.playing) {
    document.getElementById('icon-play').style.display  = 'none';
    document.getElementById('icon-pause').style.display = 'block';
    setDiscWaves(true);
    document.getElementById('waveform').classList.remove('hidden');
    if (audioEl.src && !audioEl.src.endsWith('/')) audioEl.play();
    else loadAyahData(state.surah, state.ayah, state.reciter);
  } else {
    stopPlayback();
  }
}

function stopPlayback() {
  state.playing = false;
  audioEl.pause();
  setDiscWaves(false);
  document.getElementById('icon-play').style.display  = 'block';
  document.getElementById('icon-pause').style.display = 'none';
  document.getElementById('waveform').classList.add('hidden');
}

function advanceAyah(dir) {
  const s = SURAHS[state.surah - 1];
  const next = state.ayah + dir;
  if (next < 1 || next > s.ayahs) return;
  state.ayah = next;
  state.progress = 0;
  updatePlayerUI();
}

function advanceSurah(dir) {
  const next = state.surah + dir;
  if (next < 1 || next > 114) return;
  const wasPlaying = state.playing;
  stopPlayback();
  state.surah = next;
  state.ayah  = 1;
  state.progress = 0;
  state.playing = wasPlaying;
  updatePlayerUI();
  renderList(document.getElementById('search-input').value);
}

// Controls
document.getElementById('btn-play').addEventListener('click',       togglePlay);
document.getElementById('btn-prev-ayah').addEventListener('click',  () => advanceAyah(-1));
document.getElementById('btn-next-ayah').addEventListener('click',  () => advanceAyah(1));
document.getElementById('btn-prev-surah').addEventListener('click', () => advanceSurah(-1));
document.getElementById('btn-next-surah').addEventListener('click', () => advanceSurah(1));

// â”€â”€ Reciters â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderReciters() {
  document.getElementById('reciters-grid').innerHTML = RECITERS.map(r => {
    const name = _lang === 'uz' ? RECITERS_UZ[r.id - 1] : r.name;
    return `
    <div class="reciter-card${r.id === state.reciter ? ' selected' : ''}" onclick="selectReciter(${r.id})">
      <div class="reciter-checkmark">
        <svg width="9" height="9" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3.5">
          <path d="m5 12 5 5L20 7"/>
        </svg>
      </div>
      <div class="reciter-avatar">${r.abbr}</div>
      <div class="reciter-name-text">${name}</div>
    </div>`;
  }).join('');
}

function selectReciter(id) {
  stopPlayback();
  state.reciter = id;
  localStorage.setItem('reciter', id);
  renderReciters();
  if (state.surah !== null) updatePlayerUI();
  updateProfileValues();
}

// â”€â”€ Search â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('search-input').addEventListener('input', e => {
  renderList(e.target.value);
});

// â”€â”€ Progress click (real audio seek) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('progress-track').addEventListener('click', e => {
  if (!audioEl.duration) return;
  const rect = e.currentTarget.getBoundingClientRect();
  const pct = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
  audioEl.currentTime = pct * audioEl.duration;
  state.progress = pct * 100;
  updateProgress(state.progress);
}, true);

// â”€â”€ Sleep Timer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let _sleepInterval = null;
let _sleepEnd      = null;    // timestamp ms
let _sleepMinutes  = null;    // null | number | 'surah'

const SLEEP_OPTIONS = [15, 30, 45, 60]; // minutes

// â”€â”€ Sleep Modal Dial â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SLEEP_MAX    = 120; // max minutes
const SLEEP_CIRCUM = 2 * Math.PI * 100; // â‰ˆ 628.318
let _dialMinutes   = 30;  // pending value while modal open
let _eosSelected   = false; // "end of surah" toggle

function openSleepModal() {
  // pre-fill dial with current value or default
  _dialMinutes  = (typeof _sleepMinutes === 'number') ? _sleepMinutes : 30;
  _eosSelected  = _sleepMinutes === 'surah';
  document.getElementById('sleep-sheet-title').textContent  = t('sleep_title');
  document.getElementById('sleep-eos-label').textContent    = t('sleep_end_of_surah');
  document.getElementById('sleep-cancel-btn').textContent   = t('sleep_cancel');
  document.getElementById('sleep-confirm-btn').textContent  = t('sleep_set');
  document.getElementById('sleep-min-lbl').textContent      = t('sleep_unit');
  document.getElementById('sleep-modal').classList.add('open');
  document.getElementById('sleep-eos-btn').classList.toggle('active', _eosSelected);
  updateDialUI();
  bindDialEvents();
}

function closeSleepModal() {
  document.getElementById('sleep-modal').classList.remove('open');
}

document.getElementById('sleep-modal').addEventListener('click', e => {
  if (e.target === document.getElementById('sleep-modal')) closeSleepModal();
});

function toggleEosSleep() {
  _eosSelected = !_eosSelected;
  document.getElementById('sleep-eos-btn').classList.toggle('active', _eosSelected);
}

function confirmSleepTimer() {
  closeSleepModal();
  if (_eosSelected) {
    setSleepTimer('surah');
  } else if (_dialMinutes > 0) {
    setSleepTimer(_dialMinutes);
  } else {
    clearSleepTimer(false);
  }
}

function updateDialUI() {
  const mins = _dialMinutes;
  const frac = mins / SLEEP_MAX;
  const arc  = frac * SLEEP_CIRCUM;
  document.getElementById('sleep-arc').setAttribute('stroke-dasharray', `${arc} ${SLEEP_CIRCUM}`);
  document.getElementById('sleep-min-val').textContent = mins;
  // handle position: angle from top, clockwise
  const angle = frac * 2 * Math.PI - Math.PI / 2;
  const hx = 130 + 100 * Math.cos(angle);
  const hy = 130 + 100 * Math.sin(angle);
  document.getElementById('sleep-handle').setAttribute('cx', hx.toFixed(1));
  document.getElementById('sleep-handle').setAttribute('cy', hy.toFixed(1));
}

function angleToMinutes(dx, dy) {
  // atan2 gives angle from positive x-axis; we want 0 at top, clockwise
  let angle = Math.atan2(dy, dx) + Math.PI / 2;
  if (angle < 0) angle += 2 * Math.PI;
  const raw = (angle / (2 * Math.PI)) * SLEEP_MAX;
  return Math.max(1, Math.min(SLEEP_MAX, Math.round(raw / 5) * 5 || 5));
}

function bindDialEvents() {
  const svg = document.getElementById('sleep-svg');
  const onMove = e => {
    e.preventDefault();
    const pt  = e.touches ? e.touches[0] : e;
    const rect = svg.getBoundingClientRect();
    const cx  = rect.left + rect.width  / 2;
    const cy  = rect.top  + rect.height / 2;
    _dialMinutes = angleToMinutes(pt.clientX - cx, pt.clientY - cy);
    _eosSelected = false;
    document.getElementById('sleep-eos-btn').classList.remove('active');
    updateDialUI();
  };
  svg.ontouchstart = onMove;
  svg.ontouchmove  = onMove;
  svg.onmousedown  = e => { svg.onmousemove = onMove; };
  document.onmouseup = () => { svg.onmousemove = null; };
}

function setSleepTimer(val) {
  clearSleepTimer(false);
  _sleepMinutes = val;
  if (val !== 'surah') {
    _sleepEnd = Date.now() + val * 60 * 1000;
    _sleepInterval = setInterval(() => {
      if (Date.now() >= _sleepEnd) { stopPlayback(); clearSleepTimer(false); }
      else updateSleepBtn();
    }, 1000);
  }
  updateSleepBtn();
}

function clearSleepTimer(updateBtn) {
  clearInterval(_sleepInterval);
  _sleepInterval = null;
  _sleepEnd      = null;
  _sleepMinutes  = null;
  if (updateBtn !== false) updateSleepBtn();
}

function updateSleepBtn() {
  const btn   = document.getElementById('sleep-btn');
  const label = document.getElementById('sleep-btn-label');
  if (!btn) return;
  if (_sleepMinutes === null) {
    btn.classList.remove('active');
    label.textContent = t('sleep_btn');
  } else if (_sleepMinutes === 'surah') {
    btn.classList.add('active');
    label.textContent = t('sleep_end_of_surah');
  } else {
    btn.classList.add('active');
    const rem = Math.max(0, _sleepEnd - Date.now());
    const m   = Math.floor(rem / 60000);
    const s   = Math.floor((rem % 60000) / 1000);
    label.textContent = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  }
}

// â”€â”€ Favorites â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let _favs = JSON.parse(localStorage.getItem('favs') || '[]');

function saveFavs() { localStorage.setItem('favs', JSON.stringify(_favs)); }

function favKey(type, surah, ayah) {
  return type === 'ayah' ? `a:${surah}:${ayah}` : `s:${surah}`;
}

function isFav(type, surah, ayah) {
  const k = favKey(type, surah, ayah);
  return _favs.some(f => f.key === k);
}

function toggleFav() {
  if (!state.surah) return;
  const type  = state.mode === 'ayah' ? 'ayah' : 'surah';
  const ayah  = type === 'ayah' ? state.ayah : null;
  const k     = favKey(type, state.surah, ayah);
  const idx   = _favs.findIndex(f => f.key === k);
  if (idx >= 0) {
    _favs.splice(idx, 1);
  } else {
    _favs.unshift({ key: k, type, surah: state.surah, ayah, addedAt: Date.now() });
  }
  saveFavs();
  updateFavBtn();
  updateProfileValues();
}

function toggleFavItem(key, e) {
  e.stopPropagation();
  const idx = _favs.findIndex(f => f.key === key);
  if (idx >= 0) { _favs.splice(idx, 1); saveFavs(); }
  updateProfileValues();
  renderFavorites();
  renderList(document.getElementById('search-input').value);
  updateFavBtn();
}

function toggleFavSurah(n, e) {
  e.stopPropagation();
  const k   = favKey('surah', n, null);
  const idx = _favs.findIndex(f => f.key === k);
  if (idx >= 0) _favs.splice(idx, 1);
  else _favs.unshift({ key: k, type: 'surah', surah: n, ayah: null, addedAt: Date.now() });
  saveFavs();
  updateProfileValues();
  renderList(document.getElementById('search-input').value);
  updateFavBtn();
}

function toggleFavAyah(surah, ayah, e) {
  e.stopPropagation();
  const k   = favKey('ayah', surah, ayah);
  const idx = _favs.findIndex(f => f.key === k);
  if (idx >= 0) _favs.splice(idx, 1);
  else _favs.unshift({ key: k, type: 'ayah', surah, ayah, addedAt: Date.now() });
  saveFavs();
  // refresh ayah list if open
  if (state.screen === 'ayah-list') openSurahForAyahs(surah);
  updateFavBtn();
}

function updateFavBtn() {
  if (!state.surah) return;
  const type = state.mode === 'ayah' ? 'ayah' : 'surah';
  const btn  = document.getElementById('player-fav-btn');
  if (!btn) return;
  const active = isFav(type, state.surah, type === 'ayah' ? state.ayah : null);
  btn.classList.toggle('fav', active);
}

function renderFavorites() {
  const el = document.getElementById('favs-list');
  if (!_favs.length) {
    el.innerHTML = `
      <div class="empty-state" style="padding-top:60px;">
        <div style="font-size:48px;margin-bottom:12px;">ğŸ¤</div>
        <div style="font-size:16px;font-weight:500;color:var(--text);margin-bottom:6px;">${t('favs_empty')}</div>
        <div style="font-size:13px;">${t('favs_empty_sub')}</div>
      </div>`;
    return;
  }
  const SVG_HEART = `<svg viewBox="0 0 24 24" fill="#E05C5C" stroke="#E05C5C" stroke-width="1.5"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>`;
  el.innerHTML = _favs.map(f => {
    const s    = SURAHS[f.surah - 1];
    const name = getSurahName(s);
    const meta = f.type === 'ayah' ? t('fav_ayah')(f.surah, f.ayah) : t('fav_surah')(f.surah);
    return `
    <div class="fav-item" onclick="openFav('${f.key}')">
      <div class="fav-badge">${SVG_HEART}</div>
      <div class="fav-info">
        <div class="fav-name">${name}</div>
        <div class="fav-meta">${meta}</div>
      </div>
      <div class="fav-ar">${s.ar}</div>
      <button class="fav-remove" onclick="toggleFavItem('${f.key}', event)" title="Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <path d="M18 6 6 18M6 6l12 12"/>
        </svg>
      </button>
    </div>`;
  }).join('');
}

function openFav(key) {
  const f = _favs.find(x => x.key === key);
  if (!f) return;
  stopPlayback();
  state.surah   = f.surah;
  state.ayah    = f.ayah || 1;
  state.mode    = f.type === 'ayah' ? 'ayah' : 'surah';
  state.progress = 0;
  state.playing  = true;
  document.getElementById('tab-surah').classList.toggle('active', state.mode === 'surah');
  document.getElementById('tab-ayah').classList.toggle('active',  state.mode === 'ayah');
  showScreen('player');
  updatePlayerUI();
}

// â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
applyI18n();
renderList();
renderReciters();
updatePlayerUI();
</script>
</body>
</html>
